System.register(["jimu-core","jimu-ui/advanced/setting-components","jimu-for-builder","jimu-ui","jimu-arcgis","jimu-ui/basic/color-picker","jimu-theme","jimu-ui/advanced/rich-text-editor","jimu-ui/advanced/style-setting-components","jimu-ui/basic/list-tree","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/expression-builder"],(function(e,t){var s={},i={},a={},n={},l={},r={},o={},d={},h={},p={},c={},u={};return{setters:[function(e){s.ArcGISDataSourceTypes=e.ArcGISDataSourceTypes,s.DataSourceManager=e.DataSourceManager,s.DataSourceTypes=e.DataSourceTypes,s.Immutable=e.Immutable,s.JimuFieldType=e.JimuFieldType,s.JimuMapViewStatus=e.JimuMapViewStatus,s.OrderRule=e.OrderRule,s.React=e.React,s.classNames=e.classNames,s.css=e.css,s.defaultMessages=e.defaultMessages,s.getAppStore=e.getAppStore,s.jsx=e.jsx,s.polished=e.polished,s.urlUtils=e.urlUtils},function(e){i.MapWidgetSelector=e.MapWidgetSelector,i.SettingRow=e.SettingRow,i.SettingSection=e.SettingSection,i.SidePopper=e.SidePopper},function(e){a.BaseWidgetSetting=e.BaseWidgetSetting},function(e){n.Alert=e.Alert,n.AlertPopup=e.AlertPopup,n.Button=e.Button,n.Checkbox=e.Checkbox,n.CollapsablePanel=e.CollapsablePanel,n.Dropdown=e.Dropdown,n.DropdownButton=e.DropdownButton,n.DropdownItem=e.DropdownItem,n.DropdownMenu=e.DropdownMenu,n.Icon=e.Icon,n.Label=e.Label,n.NumericInput=e.NumericInput,n.Option=e.Option,n.Radio=e.Radio,n.Select=e.Select,n.Switch=e.Switch,n.TextArea=e.TextArea,n.TextInput=e.TextInput,n.Tooltip=e.Tooltip,n.defaultMessages=e.defaultMessages},function(e){l.MapViewManager=e.MapViewManager},function(e){r.ThemeColorPicker=e.ThemeColorPicker},function(e){o.getTheme2=e.getTheme2},function(e){d.FontFamily=e.FontFamily},function(e){h.FontStyle=e.FontStyle,h.InputUnit=e.InputUnit},function(e){p.List=e.List,p.TreeItemActionType=e.TreeItemActionType},function(e){c.AllDataSourceTypes=e.AllDataSourceTypes,c.DataSourceSelector=e.DataSourceSelector,c.FieldSelector=e.FieldSelector},function(e){u.ExpressionBuilder=e.ExpressionBuilder,u.ExpressionBuilderType=e.ExpressionBuilderType}],execute:function(){e((()=>{var e={748:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5Zm-9 0a3.501 3.501 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5ZM15.5 11l-5 1-3 4-1-9.5 9 4.5Zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38-2.517.503Z" clip-rule="evenodd"></path></svg>'},41553:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M9.438.994c.213 0 .397.146.44.35.151.722.257 1.34.316 1.852.374.16.725.362 1.048.599l1.728-.676a.455.455 0 0 1 .556.188l1.42 2.394a.43.43 0 0 1-.091.547 21.98 21.98 0 0 1-1.49 1.194 5.17 5.17 0 0 1-.007 1.183l1.464 1.119a.43.43 0 0 1 .111.563l-1.42 2.394a.454.454 0 0 1-.53.197 22.445 22.445 0 0 1-1.807-.66c-.325.233-.679.43-1.055.586l-.263 1.794a.446.446 0 0 1-.445.376H6.574a.446.446 0 0 1-.44-.35 21.019 21.019 0 0 1-.317-1.853 5.34 5.34 0 0 1-1.047-.598l-1.728.675a.455.455 0 0 1-.556-.187l-1.42-2.395a.43.43 0 0 1 .091-.546c.567-.49 1.063-.888 1.49-1.194a5.167 5.167 0 0 1 .008-1.183L1.19 6.243a.43.43 0 0 1-.112-.562l1.42-2.395a.455.455 0 0 1 .531-.196c.719.233 1.321.453 1.807.66.324-.233.679-.43 1.056-.587l.262-1.794A.446.446 0 0 1 6.6.994h2.839Zm-.365 1H6.985l-.28 1.866-.467.19c-.235.095-.46.21-.672.34l-.207.136-.42.293-.476-.197c-.328-.137-.718-.281-1.169-.433l-.221-.074-1.045 1.719L3.59 6.999l-.06.479a4.127 4.127 0 0 0-.021.816l.014.144.058.492-.419.294c-.288.203-.615.451-.979.746l-.177.145 1.043 1.72 1.845-.703.406.29c.204.146.42.274.645.384l.228.103.474.199.059.49c.04.338.103.731.19 1.177l.043.219h2.088l.282-1.867.466-.19c.236-.095.46-.21.672-.34l.207-.136.419-.293.476.198c.33.136.72.28 1.17.433l.22.072 1.044-1.718-1.56-1.165.06-.479a4.131 4.131 0 0 0 .02-.815l-.013-.144-.06-.492.42-.295a18.1 18.1 0 0 0 .98-.746l.176-.146-1.043-1.72-1.844.705-.406-.29a4.496 4.496 0 0 0-.646-.385l-.228-.103-.474-.199-.058-.49c-.032-.27-.08-.576-.14-.916l-.094-.48Zm-1.067 3a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4Z" clip-rule="evenodd"></path></svg>'},11407:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.347 2.146a.485.485 0 0 1 0 .708L5.76 8l5.587 5.146a.486.486 0 0 1 0 .708.538.538 0 0 1-.738 0l-5.956-5.5a.485.485 0 0 1 0-.708l5.956-5.5a.538.538 0 0 1 .738 0Z" clip-rule="evenodd"></path></svg>'},58959:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M1.5 3a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1h-4ZM1 6.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5ZM1.5 9a.5.5 0 0 0 0 1h10a.5.5 0 0 0 0-1h-10ZM1.5 12a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1h-13Z"></path></svg>'},99820:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M1.5 13a.5.5 0 0 1 0-1h4a.5.5 0 0 1 0 1h-4ZM1 9.5a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 0-1h-7a.5.5 0 0 0-.5.5ZM1.5 7a.5.5 0 0 1 0-1h10a.5.5 0 0 1 0 1h-10ZM1.5 4a.5.5 0 0 1 0-1h13a.5.5 0 0 1 0 1h-13Z"></path></svg>'},55339:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746L8.746 8Z"></path></svg>'},59216:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M11.226 1.312c-.403-.404-1.044-.417-1.431-.03L2.49 8.587l-.48 2.674a.637.637 0 0 0 .73.73l2.673-.48 7.305-7.306c.387-.387.374-1.028-.03-1.431l-1.462-1.462Zm-8.113 9.575.32-1.781 4.991-4.992 1.462 1.462-4.992 4.991-1.781.32Zm7.473-6.012 1.402-1.4-1.462-1.463-1.401 1.402 1.461 1.461Z" clip-rule="evenodd"></path><path fill="#000" d="M1.5 14a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1h-13Z"></path></svg>'},88866:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2ZM6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5Z"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16Zm0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14Z" clip-rule="evenodd"></path></svg>'},79964:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667L8 2.125Zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47L7.118 1.653ZM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995Zm1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z" clip-rule="evenodd"></path></svg>'},17e3:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgOCA4IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMiIgaGVpZ2h0PSIxMiIgZmlsbD0nIzI4MjgyOCc+DQogICAgPHBhdGggZD0iTTMuNSAzLjV2LTNhLjUuNSAwIDAxMSAwdjNoM2EuNS41IDAgMDEwIDFoLTN2M2EuNS41IDAgMDEtMSAwdi0zaC0zYS41LjUgMCAwMTAtMWgzeiIgZmlsbC1ydWxlPSJldmVub2RkIj48L3BhdGg+DQo8L3N2Zz4="},26826:e=>{"use strict";e.exports=l},48891:e=>{"use strict";e.exports=s},23137:e=>{"use strict";e.exports=a},34796:e=>{"use strict";e.exports=o},30726:e=>{"use strict";e.exports=n},338:e=>{"use strict";e.exports=c},39342:e=>{"use strict";e.exports=u},65492:e=>{"use strict";e.exports=d},77756:e=>{"use strict";e.exports=i},55505:e=>{"use strict";e.exports=h},41362:e=>{"use strict";e.exports=r},59587:e=>{"use strict";e.exports=p}},t={};function m(s){var i=t[s];if(void 0!==i)return i.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,m),a.exports}m.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return m.d(t,{a:t}),t},m.d=(e,t)=>{for(var s in t)m.o(t,s)&&!m.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},m.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),m.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},m.p="";var y={};return m.p=window.jimuConfig.baseUrl,(()=>{"use strict";m.r(y),m.d(y,{__set_webpack_public_path__:()=>we,default:()=>Le});var e=m(48891),t=m(77756),s=m(23137),i=m(30726),a=m(26826);const n={selectMapWidgetLabel:"Select a map widget",warningMsgIfNoLayersOnMap:"The selected web map or web scene does not contain any feature layers; select maps with at least one feature layer.",generalSettingsLabel:"General Settings",highlightColor:"Sketch color",highlightColorTooltip:"Specify color for sketching on the map",onlyShowResults:"Only show results",onlyShowResultsTooltip:"Hide layers and features not included in the analysis results",noResultsFoundLabel:"No results found message",noDataMessageDefaultText:"No results found.",searchSettingsLabel:"Search Settings",headingLabel:"Heading label",locationLabel:"Location",currentMapAreaLabel:"Explore features within current map area",disabledDefineSearchAreaLabel:"Explore all features",defineSearchAreaTooltip:"Show all features or use the current map area or a location for feature search",defineSearchAreaLabel:"Define a search area",searchAreaHint:"No search area is defined and all the features will be displayed. Any configured Closest Feature analysis will be ignored.",searchByLabel:"Search by",bufferDistance:"Default search distance",distanceUnits:"Distance units",currentMapExtent:"Current map area",currentMapAreaTooltip:"Analysis will be based on features within current map area. Any configured Closest Feature analysis will be ignored",dataConfigLabel:"Map Settings",dataConfigTooltip:"Optionally, click a map below to customize search and analysis settings",mapSettingsHintMsg:"Click on a map to configure search and analysis settings.",analysisSettingsLabel:"Analysis Settings",addAnalysisLabel:"Add Analysis",configureAnalysisTooltip:"Configure closest feature, proximity, or summary analysis for layers in the map",configureLayerAnalysis:"Configure analysis for layers",layerAnalysisHint:"Configured layers will be used for analysis regardless of their visibility in the map.",selectLayer:"Select layer",closest:"Closest Feature",analysisTypeLabel:"Analysis Type",highlightResultsOnMapLabel:"Highlight results on map",analysisTypeInfoTooltip:"Closest Feature: find the closest feature to a location.\nProximity: find features within a specified distance.\nSummary: summarize the feature's numeric values.",closestFeatureMaxDistLabel:"Maximum distance",proximity:"Proximity",displayFieldLabel:"Display field",sortFeaturesLabel:"Sort features",distanceLabel:"Distance",noSelectionItemLabel:"- Select -",groupFeaturesLabel:"Group features",sortGroupsByCount:"Sort groups by count",expandOnOpen:"Expand on open",expandFeatureDetails:"Expand feature details",expandListTooltip:"Use with caution: performance may be impacted for analysis results with a large number of features.",summary:"Summary",addSummaryFields:"Add Summary",editSummaryField:"Edit Summary Field",editExpression:"Edit Expression",editAnalysis:"Edit Analysis",editSumOfIntersectedArea:"Edit sum of intersected area",editSumOfIntersectedLength:"Edit sum of intersected length",showSeparator:"Show thousand separator",sumOfIntersectedArea:"Sum of intersected area",sumOfIntersectedLength:"Sum of intersected length",sumOfAreaTooltip:"Sum of intersected area calculates the area of polygon intersected by search geometry",sumOfLengthTooltip:"Sum of intersected length calculates the length of polyline intersected by search geometry",noFormatting:"No formatting",round:"Round",truncate:"Truncate",significantDigitsLabel:"Significant digits",singleColor:"Single color",byCategory:"By category",summaryFieldColor:"Define summary colors",applyColors:"Apply colors",colorStrip:"Color strip",displayFeatureCountLabel:"Display feature count",displayAnalysisIconLabel:"Display analysis icon"};function l(t){return e.css`
  .alignTooltip {
    margin-right: -6px;
  }

  .hiddenElements {
    display: none;
  }

  .nearme-analysis-list-items {
    .analysis-item {
      padding: 4px 4px 8px 4px;

      .layer-analysis-name {
        font-size: ${e.polished.rem(14)};
        font-weight: 400;
        width: 165px;
       }

      .analysis-type-name {
        font-size: ${e.polished.rem(13)};
        padding-top: 10px;
        width: 165px;
      }
    }

    .cursor-pointer {
      cursor: pointer;
    }
  }

  .sort-field-section {
    display: flex;
    align-items: center;
    flex: 1;
    .sort-field-selector {
      background:${t.colors.palette.secondary[200]};
      border-radius: 2px;
      flex: 1;
      width: 0
    }

    .order-button {
        cursor: pointer;
        text-align:right;
        margin-left: ${e.polished.rem(2)};
    }

    .order-button svg {
        margin-right:0;
    }
  }

  .sort-icon {
    & {
        margin-left:5px;
    }

    .sort-button-l {
      border-radius: 2px 0 0 2px;
      border-right:none;
    }

    .sort-button-r {
      border-radius: 0px 2px 2px 0px;
      border-left:none;
    }

    .sort-button {
      border-color: ${t.border.color};
    }

    svg {
      margin-right:0;
    }
  }

  .cursor-pointer {
    cursor: pointer;
  }

  .add-summary-field {
    height: ${e.polished.rem(40)};
    width: 100%;
    color: ${t.colors.palette.primary[700]};
    font-size: ${e.polished.rem(14)};
    cursor: pointer;
    &:hover {
      .add-summary-field-icon-container {
        background-color: ${t.colors.palette.primary[800]};
      }
      color: ${t.colors.palette.primary[800]};
    }
    .add-summary-field-icon-container {
      width: 20px;
      height: 20px;
      background-color: ${t.colors.palette.primary[700]};
      border-radius: 10px;
    }
    .add-summary-field-icon {
      color: ${t.colors.palette.light[300]};
    }
  }

  .fieldName {
    width: 180px;
  }

  .nearme-summary-fields-list-items {
    flex: 1;
    max-height: 290px;
    overflow-y: auto;
    margin-bottom: 10px;
    margin-top: 3px;

    .jimu-tree-item_template-TYPICAL .jimu-tree-item__body {
      background-color: transparent;
    }

    .labelAlign {
      width: calc(100% - 65px);
      max-width: 155px;
    }

    .jimu-tree-item.jimu-tree-item_dnd-true {
      height: auto;
      padding-top: 0rem;
  
      .jimu-tree-item__body {
        padding: 4px 0px 4px 0px;
      }
    }
  }

  .nearme-divider {
    border-top: 1px solid var(--light-800);
  }

  .colorModesWidth {
    width: calc(100% - 30px);
  }
  `}function r(t){return e.css`
    position: absolute;
    top: 0;
    bottom: 0;
    width: 259px;
    height: 100%;
    padding-bottom: 1px;
    border-right: 1px solid ${t.colors.white};
    border-bottom: 1px solid ${t.colors.white};

    .setting-container {
      height: calc(100% - 52px);
      overflow: auto;
    }
`}function o(t){return e.css`
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    color: var(--dark-800);
    > .color-list {
      width: 100%;
      flex-grow: 1;
      overflow-y: auto;
      max-height: 562px;
    }
    > .footer {
      height: 57px;
      width: 100%;
      border-top: 1px solid #6a6a6a;
      > div {
        display: flex;
        width: 100%;
        justify-content: space-between;
      }
    }

    .colorItemStyle {
      display: flex;
      width: 100%;
      justify-content: space-between;
      label {
        width: 88%;
        flex-grow: 1;
        display: inline-flex;
        justify-content: space-between;
        .label {
          max-width: 70%;
        }
      }
    }
`}var d=m(748),h=m.n(d);const p=t=>{const s=window.SVG,{className:i}=t,a=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s}(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:n,src:h()},a)):e.React.createElement("svg",Object.assign({className:n},a))};const c=t=>e.DataSourceManager.getInstance().getDataSource(t);var u;!function(e){e[e.Feet=528e4]="Feet",e[e.Miles=1e3]="Miles",e[e.Kilometers=1609.344]="Kilometers",e[e.Meters=1609344]="Meters",e[e.Yards=176e4]="Yards"}(u||(u={}));const g=e=>{switch(e){case"feet":return u.Feet;case"miles":return u.Miles;case"kilometers":return u.Kilometers;case"meters":return u.Meters;case"yards":return u.Yards;default:return 1e3}},f=(e,t)=>{const s=g(t);return e>s?s:e},S=t=>{return s=void 0,i=void 0,l=function*(){let s=null;const i=[];let n=!1;const l=a.MapViewManager.getInstance().getJimuMapViewById(t),r=yield null==l?void 0:l.whenAllJimuLayerViewLoaded();for(const t in r){const a=yield l.whenJimuLayerViewLoaded(t);s=c(a.layerDataSourceId),s&&((null==s?void 0:s.type)===e.DataSourceTypes.MapService||(null==s?void 0:s.type)===e.DataSourceTypes.GroupLayer?s.getChildDataSources().forEach((e=>{i.push(e)})):i.length>0?(i.find((e=>e.id===s.id))||(n=!0),n&&i.push(s)):i.push(s))}return i},new((n=void 0)||(n=Promise))((function(e,t){function a(e){try{o(l.next(e))}catch(e){t(e)}}function r(e){try{o(l.throw(e))}catch(e){t(e)}}function o(t){var s;t.done?e(t.value):(s=t.value,s instanceof n?s:new n((function(e){e(s)}))).then(a,r)}o((l=l.apply(s,i||[])).next())}));var s,i,n,l},x=e=>{let t="";return t=e.objectIdField?e.objectIdField:e.displayField?e.displayField:e.fields[0].name,t},b=()=>{const t=(0,e.getAppStore)().getState().portalSelf;return"english"===(null==t?void 0:t.units)?"miles":"kilometers"};var v=m(41362),F=m(88866),C=m.n(F);const I=t=>{const s=window.SVG,{className:i}=t,a=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s}(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:n,src:C()},a)):e.React.createElement("svg",Object.assign({className:n},a))};var L,w=m(34796),j=m(65492),O=m(55505);class A extends e.React.PureComponent{constructor(e){var t,s,i,a,l,r,o;super(e),this.nls=e=>{var t;const s=Object.assign({},n);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidUpdate=(e,t)=>{e.theme.colors.palette.primary[700]!==this.props.theme.colors.palette.primary[700]&&this.setState({highlightColor:this.props.theme.colors.palette.primary[700]},(()=>{this.props.onGeneralSettingsUpdated("highlightColor",this.state.highlightColor)}))},this.onHighlightColorChange=e=>{this.setState({highlightColor:e},(()=>{this.props.onGeneralSettingsUpdated("highlightColor",this.state.highlightColor)}))},this.onTextChange=e=>{this.setState({noResultsFoundMessage:e}),this.props.onGeneralSettingsUpdated("noResultsFoundText",e)},this.textStyleObj=(e,t,s,i,a,n,l)=>{const r={fontFamily:e,fontBold:t,fontItalic:s,fontUnderline:i,fontStrike:a,fontColor:n,fontSize:l};this.props.onGeneralSettingsUpdated("noResultMsgStyleSettings",r)},this.handleFontChange=e=>{this.setState({fontFamily:e},(()=>{this.textStyleObj(e,this.state.fontBold,this.state.fontItalic,this.state.fontUnderline,this.state.fontStrike,this.state.fontColor,this.state.fontSize)}))},this.setFontStyleValues=()=>{this.textStyleObj(this.state.fontFamily,this.state.fontBold,this.state.fontItalic,this.state.fontUnderline,this.state.fontStrike,this.state.fontColor,this.state.fontSize)},this.handleFontStyleChange=(e,t)=>{switch(e){case"bold":this.setState({fontBold:t},(()=>{this.setFontStyleValues()}));break;case"italic":this.setState({fontItalic:t},(()=>{this.setFontStyleValues()}));break;case"underline":this.setState({fontUnderline:t,fontStrike:!1},(()=>{this.setFontStyleValues()}));break;case"strike":this.setState({fontUnderline:!1,fontStrike:t},(()=>{this.setFontStyleValues()}))}},this.handleColorChange=e=>{this.setState({fontColor:e||"var(--black)"},(()=>{this.textStyleObj(this.state.fontFamily,this.state.fontBold,this.state.fontItalic,this.state.fontUnderline,this.state.fontStrike,this.state.fontColor,this.state.fontSize)}))},this.handleFontSizeChange=e=>{e&&this.setState({fontSize:e.distance+e.unit},(()=>{this.textStyleObj(this.state.fontFamily,this.state.fontBold,this.state.fontItalic,this.state.fontUnderline,this.state.fontStrike,this.state.fontColor,this.state.fontSize)}))},this.props.config&&(this.state={noResultsFoundMessage:this.props.config.noResultsFoundText,highlightColor:this.props.config.highlightColor?this.props.config.highlightColor:"#00FFFF",fontFamily:null===(t=this.props.config.noResultMsgStyleSettings)||void 0===t?void 0:t.fontFamily,fontBold:null===(s=this.props.config.noResultMsgStyleSettings)||void 0===s?void 0:s.fontBold,fontItalic:null===(i=this.props.config.noResultMsgStyleSettings)||void 0===i?void 0:i.fontItalic,fontUnderline:null===(a=this.props.config.noResultMsgStyleSettings)||void 0===a?void 0:a.fontUnderline,fontStrike:null===(l=this.props.config.noResultMsgStyleSettings)||void 0===l?void 0:l.fontStrike,fontColor:null===(r=this.props.config.noResultMsgStyleSettings)||void 0===r?void 0:r.fontColor,fontSize:null===(o=this.props.config.noResultMsgStyleSettings)||void 0===o?void 0:o.fontSize})}render(){return(0,e.jsx)("div",{style:{height:"100%",width:"100%",marginTop:10}},(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("highlightColor"))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("highlightColorTooltip"),title:this.nls("highlightColorTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 mr-3 d-inline"},(0,e.jsx)(I,null))),(0,e.jsx)(v.ThemeColorPicker,{"aria-label":this.nls("highlightColor"),specificTheme:(0,w.getTheme2)(),value:this.state.highlightColor?this.state.highlightColor:"#00FFFF",onChange:e=>{this.onHighlightColorChange(e)}})),(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(i.Label,{"aria-label":this.nls("noResultsFoundLabel"),title:this.nls("noResultsFoundLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 setting-text-level-3"},this.nls("noResultsFoundLabel"))),(0,e.jsx)(i.TextArea,{tabIndex:0,className:"w-100",name:"text","aria-label":this.nls("noResultsFoundLabel")+this.state.noResultsFoundMessage,defaultValue:this.props.config.noResultsFoundText||this.nls("noDataMessageDefaultText"),onBlur:e=>{this.onTextChange(e.target.value)}})),(0,e.jsx)("div",{className:"w-100 pt-2 pb-2"},(0,e.jsx)(j.FontFamily,{className:"w-100",font:this.state.fontFamily,onChange:this.handleFontChange}),(0,e.jsx)("div",{className:"d-flex justify-content-between mt-2"},(0,e.jsx)(O.FontStyle,{style:{width:"103px"},onChange:this.handleFontStyleChange,bold:this.state.fontBold,italic:this.state.fontItalic,underline:this.state.fontUnderline,strike:this.state.fontStrike}),(0,e.jsx)(v.ThemeColorPicker,{style:{width:"25px"},specificTheme:(0,w.getTheme2)(),value:this.state.fontColor,onChange:this.handleColorChange}),(0,e.jsx)(O.InputUnit,{style:{width:"76px"},value:this.state.fontSize,onChange:this.handleFontSizeChange}))))}}!function(e){e.Closest="closest",e.Proximity="proximity",e.Summary="summary"}(L||(L={}));const D=[{value:"feet",label:"Feet"},{value:"meters",label:"Meters"},{value:"kilometers",label:"Kilometers"},{value:"miles",label:"Miles"},{value:"yards",label:"Yards"}],T=[L.Closest,L.Proximity,L.Summary],M={analysisType:T[0],closestFeatureMaxDistance:80,distanceUnit:"",expandOnOpen:!0},N="#FFFFFF00",R=[{analysisType:T[0],closestFeatureMaxDistance:80,distanceUnit:"",expandOnOpen:!0},{analysisType:T[1],displayField:"",sortFeaturesByDistance:!0,sortFeatures:{sortFeaturesByField:"",sortFeaturesOrder:"ASC"},groupFeaturesEnabled:!1,groupFeatures:{groupFeaturesByField:"",groupFeaturesOrder:"ASC"},sortGroupsByCount:!1,highlightResultsOnMap:!0,expandOnOpen:!1,expandFeatureDetails:!1},{analysisType:T[2],isSingleColorMode:!0,singleFieldColor:N,summaryFields:[],highlightResultsOnMap:!0,expandOnOpen:!1}],k={analysisSettings:{onlyShowLayersResult:!1,layersInfo:[],displayFeatureCount:!0,displayAnalysisIcon:!0},searchSettings:{headingLabel:"",defineSearchArea:!0,bufferDistance:1,distanceUnits:"",searchByCurrentMapExtent:!1}};var E,B,P;!function(e){e.NoFormatting="noFormatting",e.Round="round",e.Truncate="truncate"}(E||(E={})),function(e){e.SumOfIntersectedArea="sumOfIntersectedArea",e.SumOfIntersectedLength="sumOfIntersectedLength"}(B||(B={})),B.SumOfIntersectedLength,E.NoFormatting,B.SumOfIntersectedArea,E.NoFormatting,function(e){e.SingleColor="singleColor",e.ByCategory="byCategory"}(P||(P={}));const U=["#5E8FD0","#77B484","#DF6B35","#DBCF4E","#41546D","#8257C2","#D6558B"],V=[U,["#596A90","#85C2E4","#DEB3D9","#9FB6E1","#BBE4EF","#C5B2E1","#8482D0"],["#A6382F","#47707A","#F0CF35","#D18332","#B9C143","#E38B67","#AAC86A"],["#E49DAF","#B1F2D0","#F5F49A","#94CAFC","#E9C7A3","#C9A7E8","#DDF3AA"],["#004CA3","#005ECA","#076FE5","#2C8FFF","#65ADFF","#ACD3FF","#E6F2FF"],["#7D5D00","#AA7F00","#DDA400","#FFC300","#FFCE2F","#FFDE72","#FFEDB1"],["#4E427E","#6A5A9E","#8E7AC3","#A293D9","#B0A3E7","#C4B7EB","#DFD9F1"],["#BA4300","#ED5500","#FF7121","#FF8D4C","#FFA878","#FFC4A3","#FFE0CE"]];class G extends e.React.PureComponent{constructor(e){if(super(e),this.nls=e=>{var t;const s=Object.assign({},n,i.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.onHeadingLabelChange=e=>{this.setState({headingLabelText:e})},this.onHeadingLabelAcceptValue=()=>{this.props.onSearchSettingsUpdated("headingLabel",this.state.headingLabelText)},this.onDefineSearchAreaChange=e=>{this.setState({defineSearchAreaOption:e.target.checked},(()=>{this.props.onSearchSettingsUpdated("defineSearchArea",this.state.defineSearchAreaOption),this.setState({headingLabelText:e.target.checked?this.props.config.searchByCurrentMapExtent?this.nls("currentMapAreaLabel"):this.nls("locationLabel"):this.nls("disabledDefineSearchAreaLabel")},(()=>{setTimeout((()=>{this.props.onSearchSettingsUpdated("headingLabel",this.state.headingLabelText)}),100)}))}))},this.onDistanceUnitChange=e=>{const t=f(this.state.bufferDistance,e.target.value);this.props.onSearchSettingsUpdated("bufferDistance",t),this.setState({distanceUnits:e.target.value,bufferDistance:t},(()=>{setTimeout((()=>{this.props.onSearchSettingsUpdated("distanceUnits",this.state.distanceUnits)}),50)}))},this.onBufferDistanceChange=e=>{this.setState({bufferDistance:null!=e?e:1},(()=>{this.props.onSearchSettingsUpdated("bufferDistance",this.state.bufferDistance)}))},this.handleSearchByChange=e=>{this.setState({headingLabelText:e?this.nls("currentMapAreaLabel"):this.nls("locationLabel")},(()=>{setTimeout((()=>{this.props.onSearchSettingsUpdated("headingLabel",this.state.headingLabelText)}),100)})),this.props.onSearchSettingsUpdated("searchByCurrentMapExtent",e)},this.props.config){const e=""!==this.props.config.distanceUnits?this.props.config.distanceUnits:b();this.state={headingLabelText:this.props.config.headingLabel?this.props.config.headingLabel:this.nls("locationLabel"),defineSearchAreaOption:this.props.config.defineSearchArea,bufferDistance:this.props.config.bufferDistance,distanceUnits:e}}}render(){return(0,e.jsx)("div",{css:(this.props.theme,e.css`
    .cursor-pointer {
      cursor: pointer;
    }
  `),style:{height:"100%",width:"100%",marginTop:10}},(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{className:"pr-2 w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("defineSearchAreaLabel"))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("defineSearchAreaLabel")+" "+this.nls("defineSearchAreaTooltip"),title:this.nls("defineSearchAreaTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 mr-3 d-inline"},(0,e.jsx)(I,null))),(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("defineSearchAreaLabel"),title:this.nls("defineSearchAreaLabel"),checked:this.state.defineSearchAreaOption,onChange:this.onDefineSearchAreaChange})),!this.state.defineSearchAreaOption&&(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("searchAreaHint"),className:"font-italic w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("searchAreaHint")))),this.state.defineSearchAreaOption&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("searchByLabel"),title:this.nls("searchByLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 setting-text-level-3"},this.nls("searchByLabel")))),(0,e.jsx)(t.SettingRow,{className:"mt-1",flow:"wrap"},(0,e.jsx)(i.Label,{className:"m-0 w-100",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("currentMapExtent"),className:"cursor-pointer",value:"currentMapExtent",onChange:()=>{this.handleSearchByChange(!0)},checked:this.props.config.searchByCurrentMapExtent}),(0,e.jsx)("div",{tabIndex:0,className:"w-100 text-break",onClick:e=>{e.preventDefault()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleSearchByChange(!0)}},(0,e.jsx)("span",{className:"ml-1 cursor-pointer",onClick:()=>{this.handleSearchByChange(!0)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleSearchByChange(!0)}},this.nls("currentMapExtent"))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("currentMapAreaTooltip"),title:this.nls("currentMapAreaTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 d-inline",onClick:e=>{e.preventDefault()}},(0,e.jsx)(I,null))))),(0,e.jsx)(t.SettingRow,{className:"mt-2",flow:"wrap"},(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("location"),className:"cursor-pointer",value:"location",onChange:()=>{this.handleSearchByChange(!1)},checked:!this.props.config.searchByCurrentMapExtent}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleSearchByChange(!1)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleSearchByChange(!1)}},this.nls("location")))),!this.props.config.searchByCurrentMapExtent&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingRow,{className:"mt-3 ml-3",flow:"wrap"},(0,e.jsx)(i.Label,{title:this.nls("bufferDistance"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 setting-text-level-3"},this.nls("bufferDistance"))),(0,e.jsx)(i.NumericInput,{"aria-label":this.nls("bufferDistance"),style:{width:"240px"},size:"sm",min:0,max:g(this.state.distanceUnits),defaultValue:this.state.bufferDistance,value:this.state.bufferDistance,onChange:this.onBufferDistanceChange})),(0,e.jsx)(t.SettingRow,{className:"ml-3",flow:"wrap"},(0,e.jsx)(i.Label,{title:this.nls("distanceUnits"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 setting-text-level-3"},this.nls("distanceUnits"))),(0,e.jsx)(i.Select,{style:{marginBottom:"8px"},"aria-label":this.nls("distanceUnits")+" "+this.state.distanceUnits,size:"sm",value:this.state.distanceUnits,onChange:e=>{this.onDistanceUnitChange(e)}},D.map(((t,s)=>(0,e.jsx)(i.Option,{role:"option",tabIndex:0,"aria-label":t.label,value:t.value,key:s},t.label))))))),(0,e.jsx)(t.SettingRow,{label:this.nls("headingLabel"),flow:"wrap"},(0,e.jsx)(i.TextArea,{tabIndex:0,className:"w-100",spellCheck:!1,value:this.state.headingLabelText,onChange:e=>{this.onHeadingLabelChange(e.target.value)},onAcceptValue:this.onHeadingLabelAcceptValue})))}}var z=m(79964),W=m.n(z);const _=t=>{const s=window.SVG,{className:i}=t,a=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s}(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:n,src:W()},a)):e.React.createElement("svg",Object.assign({className:n},a))};var H=m(59587),Z=m(55339),K=m.n(Z);const $=t=>{const s=window.SVG,{className:i}=t,a=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s}(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:n,src:K()},a)):e.React.createElement("svg",Object.assign({className:n},a))};class J extends e.React.PureComponent{constructor(t){super(t),this.analysisSettingPopperTrigger=e.React.createRef(),this.nls=e=>{var t;const s=Object.assign({},n);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{1===this.state.addedLayerAnalysis.length&&this.setState({selectedAnalysis:this.props.addedLayerAnalysis.length-1})},this.componentDidUpdate=e=>{var t,s,i,a;(null===(t=null==e?void 0:e.addedLayerAnalysis)||void 0===t?void 0:t.length)!==(null===(i=null===(s=this.props)||void 0===s?void 0:s.addedLayerAnalysis)||void 0===i?void 0:i.length)&&this.setState({addedLayerAnalysis:this.props.addedLayerAnalysis,selectedAnalysis:this.props.addedLayerAnalysis.length-1}),(null==e?void 0:e.addedLayerAnalysis)!==(null===(a=this.props)||void 0===a?void 0:a.addedLayerAnalysis)&&this.setState({addedLayerAnalysis:this.props.addedLayerAnalysis})},this.onAnalysisOrderChanged=e=>{let t=-1;this.props.editCurrentLayer&&(t=e.findIndex((e=>e.useDataSource.dataSourceId===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===this.props.editCurrentLayer.analysisType)),this.setState({selectedAnalysis:t})),this.setState({addedLayerAnalysis:e},(()=>{this.props.onLayersInfoSettingsUpdated(this.state.addedLayerAnalysis,-1!==t?t:this.props.analysisIndex,this.props.editCurrentLayer.layerDsId,this.props.editCurrentLayer.analysisType)}))},this.onEditAction=(e,t,s)=>{this.props.onEditAction(!0,e,t,s),this.state.addedLayerAnalysis.some(((e,t)=>s===t&&(this.setState({selectedAnalysis:s}),!0)))},this.onRemoveAction=(e,t,s,i)=>{e.stopPropagation();const a=this.state.addedLayerAnalysis;a.splice(i,1);let n=-1;this.props.editCurrentLayer&&(n=a.findIndex((e=>e.useDataSource.dataSourceId===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===this.props.editCurrentLayer.analysisType)),this.setState({selectedAnalysis:n})),this.setState({addedLayerAnalysis:a},(()=>{this.props.onDeleteAction(this.state.addedLayerAnalysis,t,s,n)}))},this.createAnalysisItem=(t,s)=>{var a,n;return(0,e.jsx)("div",{className:(0,e.classNames)("flex-grow-1 analysis-item cursor-pointer"),key:s},(0,e.jsx)("div",{className:"d-flex w-100 justify-content-between align-items-center"},(0,e.jsx)("div",{className:"layer-analysis-name text-truncate",title:t.label},t.label),(0,e.jsx)(i.Button,{role:"button","aria-label":this.nls("deleteOption"),title:this.nls("deleteOption"),type:"tertiary",size:"sm",icon:!0,onClick:e=>{this.onRemoveAction(e,t.useDataSource.dataSourceId,t.analysisInfo.analysisType,s)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onRemoveAction(e,t.useDataSource.dataSourceId,t.analysisInfo.analysisType,s)}},(0,e.jsx)($,{size:"s",className:"p-0"}))),(0,e.jsx)("div",{className:"text-dark-600 d-flex align-items-center analysis-type-name"},(0,e.jsx)("div",{className:"w-100 text-truncate",title:this.nls(null===(a=null==t?void 0:t.analysisInfo)||void 0===a?void 0:a.analysisType)},this.nls(null===(n=null==t?void 0:t.analysisInfo)||void 0===n?void 0:n.analysisType))))},this.getLayersInfoList=()=>{var t;return(0,e.jsx)("div",{className:"nearme-analysis-list-items"},(0,e.jsx)(H.List,{itemsJson:null===(t=Array.from(this.state.addedLayerAnalysis?this.state.addedLayerAnalysis:null))||void 0===t?void 0:t.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:this.props.showEditAnalysisPopper&&this.state.selectedAnalysis===t}))),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:s}=t.props,[,i]=s,a=i.map((e=>e.itemStateDetailContent));this.onAnalysisOrderChanged(a)},onClickItemBody:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1],n=i.itemStateDetailContent;this.onEditAction(n.useDataSource.dataSourceId,n.analysisInfo.analysisType,a.indexOf(i))},overrideItemBlockInfo:({itemBlockInfo:e})=>({name:H.TreeItemActionType.RenderOverrideItem,children:[{name:H.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:H.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:H.TreeItemActionType.RenderOverrideItemBody,children:[{name:H.TreeItemActionType.RenderOverrideItemDragHandle},{name:H.TreeItemActionType.RenderOverrideItemMainLine}]}]}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createAnalysisItem(i.itemStateDetailContent,a.indexOf(i))}}))},this.state={selectedAnalysis:this.props.analysisIndex?this.props.analysisIndex:-1,addedLayerAnalysis:this.props.addedLayerAnalysis}}render(){return(0,e.jsx)(e.React.Fragment,null,this.getLayersInfoList())}}var q=m(59216),Y=m.n(q);const Q=t=>{const s=window.SVG,{className:i}=t,a=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s}(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:n,src:Y()},a)):e.React.createElement("svg",Object.assign({className:n},a))};var X=m(41553),ee=m.n(X);const te=t=>{const s=window.SVG,{className:i}=t,a=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s}(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:n,src:ee()},a)):e.React.createElement("svg",Object.assign({className:n},a))};var se=m(11407),ie=m.n(se);const ae=t=>{const s=window.SVG,{className:i}=t,a=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s}(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:n,src:ie()},a)):e.React.createElement("svg",Object.assign({className:n},a))};class ne extends e.React.PureComponent{constructor(){super(...arguments),this.backRef=e.React.createRef(),this.nls=t=>{var s;const a=Object.assign({},n,i.defaultMessages,e.defaultMessages);return(null===(s=this.props.intl)||void 0===s?void 0:s.formatMessage)?this.props.intl.formatMessage({id:t,defaultMessage:a[t]}):a[t]},this.backRefFocus=()=>{setTimeout((()=>{var e,t;null===(t=null===(e=this.backRef)||void 0===e?void 0:e.current)||void 0===t||t.focus()}),50)}}getStyle(t){var s,i,a;return e.css`
      .setting-header {
        padding: ${e.polished.rem(18)} ${e.polished.rem(16)} ${e.polished.rem(0)} ${e.polished.rem(16)}
      }

      .setting-title {
        font-size: ${e.polished.rem(16)};
        color: ${null===(a=null===(i=null===(s=null==t?void 0:t.colors)||void 0===s?void 0:s.palette)||void 0===i?void 0:i.dark)||void 0===a?void 0:a[600]}
      }
    `}render(){return(0,e.jsx)("div",{tabIndex:-1,className:"w-100 h-100",css:this.getStyle(this.props.theme)},(0,e.jsx)("div",{tabIndex:-1,className:"w-100 d-flex align-items-center justify-content-between setting-header border-0",style:{height:"38px",marginBottom:"20px"}},this.props.hideBackArrow?(0,e.jsx)("div",{"aria-label":this.props.title,tabIndex:0,className:"setting-title mt-1",style:{maxWidth:"190px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:this.props.title},this.props.title):(0,e.jsx)("div",{tabIndex:-1,className:"h-100"},(0,e.jsx)("div",{ref:this.backRef,tabIndex:0,className:"d-flex align-items-center h-100",style:{cursor:"pointer"},onClick:this.props.onBack,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.props.onBack()}},(0,e.jsx)("div",{className:"d-flex align-items-center",title:this.nls("back"),"aria-label":this.nls("back")},(0,e.jsx)(ae,{autoFlip:!0,size:"14",className:"text-dark"})),(0,e.jsx)("div",{"aria-label":this.props.title,className:"pl-2 setting-title",style:{maxWidth:"190px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:this.props.title},this.props.title)))),this.props.children)}}const le=e.css`
  padding: 12px 0px;
  .jimu-dropdown-item {
    padding: 4px 16px !important;
    &:hover {
      background-color: var(--light-500) !important;
    }
  }
`,re=e.css`
  display: flex;
  width: 100%;
  > .color-item {
    width: 30px;
    height: 16px;
  }
`;class oe extends e.React.PureComponent{constructor(t){super(t),this.nls=e=>{var t;const s=Object.assign({},n);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidUpdate=e=>{if(e.summaryFieldsInfo!==this.props.summaryFieldsInfo){const e=Object.assign({},this.state.colorUpdate);this.props.summaryFieldsInfo.forEach(((t,s)=>{e[t.fieldLabel+"_"+s]={_fieldLabel:t.fieldLabel,_fillColor:t.fieldColor}})),this.setState({colorUpdate:e})}},this.getFieldsColor=()=>{const e={};return this.props.summaryFieldsInfo.forEach(((t,s)=>{e[t.fieldLabel+"_"+s]={_fieldLabel:t.fieldLabel,_fillColor:t.fieldColor===N?U[s%U.length]:t.fieldColor}})),e},this.onStripColorChange=(t,s)=>{t.stopPropagation();const i=((t,s)=>{if(!s)return;let i=(0,e.Immutable)({});return Object.entries(t).forEach((([e,t],a)=>{const n=((e,t=0)=>{if(null==e?void 0:e.length)return e[t%e.length]})(s,a),l=Object.assign({},t);l._fillColor=n,i=i.set(e,l)})),i})(this.state.colorUpdate,s);this.setState({colorUpdate:i},(()=>{this.props.updateFieldColorsValues(i)}))},this.onIndividualFieldColorChange=(e,t)=>{const s=Object.assign({},this.state.colorUpdate);s[e]={_fillColor:t},this.setState({colorUpdate:s},(()=>{this.props.updateFieldColorsValues(s)}))},this.state={colorUpdate:this.getFieldsColor()}}render(){return(0,e.jsx)("div",{style:{width:"100%",overflow:"auto"},css:o},(0,e.jsx)("div",{className:"color-list pt-1 px-3"},Object.entries(this.state.colorUpdate).map((([t,s],a)=>{const n=s;return(0,e.jsx)("div",{className:"mb-2 colorItemStyle",key:a},(0,e.jsx)(i.Label,{check:!0},(0,e.jsx)("span",{className:"label text-truncate",title:n._fieldLabel},n._fieldLabel),(0,e.jsx)(v.ThemeColorPicker,{"aria-label":n._fieldLabel,specificTheme:(0,w.getTheme2)(),value:n._fillColor,onChange:e=>{this.onIndividualFieldColorChange(t,e)}})))}))),(0,e.jsx)("div",{className:"footer"},(0,e.jsx)("div",{className:"px-3",style:{marginTop:"14px"}},(0,e.jsx)(i.Dropdown,{className:"w-100"},(0,e.jsx)(i.DropdownButton,{size:"sm",title:this.nls("applyColors")},this.nls("applyColors")),(0,e.jsx)(i.DropdownMenu,{showArrow:!0,css:le},(0,e.jsx)("div",{tabIndex:0},V.map(((t,s)=>(0,e.jsx)(i.DropdownItem,{tabIndex:0,className:"my-1",key:s,onClick:e=>{var s;null===(s=this.onStripColorChange)||void 0===s||s.call(this,e,t)},onKeyDown:e=>{var s;"Enter"!==e.key&&" "!==e.key||null===(s=this.onStripColorChange)||void 0===s||s.call(this,e,t)}},(0,e.jsx)("div",{tabIndex:0,"aria-label":this.nls("colorStrip")+s,css:re},t.map(((t,s)=>(0,e.jsx)("div",{className:"color-item",key:s,style:{backgroundColor:t}})))))))))))))}}var de=m(338),he=m(58959),pe=m.n(he);const ce=t=>{const s=window.SVG,{className:i}=t,a=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s}(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:n,src:pe()},a)):e.React.createElement("svg",Object.assign({className:n},a))};var ue=m(99820),me=m.n(ue);const ye=t=>{const s=window.SVG,{className:i}=t,a=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s}(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:n,src:me()},a)):e.React.createElement("svg",Object.assign({className:n},a))};var ge=m(39342);class fe extends e.React.PureComponent{constructor(e){super(e),this.nls=e=>{var t;const s=Object.assign({},n);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.handleExpressionChange=e=>{null!=e&&(e.parts.forEach((e=>{var t;e.dataSourceId&&(e.dataSourceId=null===(t=this.state.useDataSource)||void 0===t?void 0:t[0].dataSourceId)})),this.setState({updatedFieldExpression:e}),this.updateSummaryField(e.name,e))},this.updateSummaryField=(e,t)=>{const s={fieldLabel:e,selectedExpression:t};this.props.expressionInfoUpdate(s)};const t=c(this.props.currentLayerDsId.layerDsId),s=[{dataSourceId:t.id,mainDataSourceId:t.id,rootDataSourceId:t.parentDataSource.id}];this.state={useDataSource:s,updatedFieldExpression:null!==this.props.fieldsEditIndex?this.props.editingField.summaryFieldInfo:null}}render(){var t;return(0,e.jsx)(ge.ExpressionBuilder,{className:"p-2",css:(this.props.theme,e.css`
    .component-main-data-and-view {
      display: none;
    }

    .component-expression-builder .expression-editor-helper {
      height: calc(100% - 25px)!important;
    }

    .component-expression-builder .statistics-tab {
      padding-top: 0px!important;
    }

    .component-expression-builder .statistics-tab div {
      padding-top: 0px!important;
    }

    .expression-editor-container div {
      padding: 0px!important;
    }

    .component-expression-editor .exp-editor-helper-tab {
      margin-left: 0px!important;
      margin-right: 0px!important;
    }

    .component-field-selector .item-selector-search {
      margin-top: 18px!important;
    }
  `),fieldTypes:(0,e.Immutable)([e.JimuFieldType.Number]),widgetId:this.props.widgetId,types:(0,e.Immutable)([ge.ExpressionBuilderType.Statistics,ge.ExpressionBuilderType.Expression]),useDataSources:(0,e.Immutable)([null===(t=this.state.useDataSource)||void 0===t?void 0:t[0]]),expression:this.state.updatedFieldExpression,onChange:this.handleExpressionChange})}}class Se extends e.React.PureComponent{constructor(e){var t,s,a,l;super(e),this.nls=e=>{var t;const s=Object.assign({},n,i.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.onFieldLabelChange=e=>{const t=e.target.value;this.setState({summaryFieldLabel:t})},this.onFieldLabelAcceptValue=e=>{this.setState({summaryFieldLabel:e.trim()})},this.onOkButtonClicked=()=>{""!==this.state.summaryFieldLabel&&(this.setState({isEditSummaryPopperActive:!1}),this.props.onOkClick(this.state.summaryFieldLabel,this.state.showThousandSeparator,this.state.formattingOptions,this.state.significantDigit),this.props.onClose())},this.onCancelButtonClicked=()=>{this.setState({isEditSummaryPopperActive:!1}),this.props.onClose()},this.onSeparatorChange=e=>{this.setState({showThousandSeparator:e.target.checked})},this.handleFormattingChange=e=>{this.setState({formattingOptions:e.target.value}),e.target.value!==E.Round&&e.target.value!==E.Truncate||this.setState({significantDigit:2})},this.onDigitsChange=e=>{const t=Math.floor(e);this.setState({significantDigit:t})},this.state={isEditSummaryPopperActive:this.props.isOpen,showThousandSeparator:null===(t=this.props.editSummaryFields.summaryFieldInfo)||void 0===t?void 0:t.showSeparator,summaryFieldLabel:null===(s=this.props.editSummaryFields)||void 0===s?void 0:s.fieldLabel,formattingOptions:null===(a=this.props.editSummaryFields.summaryFieldInfo)||void 0===a?void 0:a.numberFormattingOption,significantDigit:null===(l=this.props.editSummaryFields.summaryFieldInfo)||void 0===l?void 0:l.significantDigits}}render(){const t=e.css`
      .hidden{
        display: none;
      }

      .cursor-pointer {
        cursor: pointer;
      }

      .separatorSwitch {
        margin-left: 130px;
      }

      .modal-content  {
        background: var(--light-300);
      }

      .invalid-value {
        border: 1px solid  ${this.props.theme.colors.danger};
        box-shadow: 0 0 5px  ${this.props.theme.colors.danger};
      }
    `;return(0,e.jsx)("div",null,(0,e.jsx)(i.AlertPopup,{css:t,"aria-expanded":this.state.isEditSummaryPopperActive,isOpen:this.state.isEditSummaryPopperActive,onClickOk:this.onOkButtonClicked.bind(this),onClickClose:this.onCancelButtonClicked.bind(this),title:this.props.sumOfIntersectedFieldPopupTitle},(0,e.jsx)("table",{cellPadding:10},(0,e.jsx)("tbody",null,(0,e.jsx)("tr",null,(0,e.jsx)("td",null,(0,e.jsx)(i.Label,{className:"mt-2"},this.nls("label"))),(0,e.jsx)("td",{colSpan:2},(0,e.jsx)(i.TextInput,{role:"textbox","aria-label":this.nls("label")+this.state.summaryFieldLabel,size:"sm",title:this.state.summaryFieldLabel,className:""===this.state.summaryFieldLabel?"invalid-value":"",value:this.state.summaryFieldLabel,onAcceptValue:this.onFieldLabelAcceptValue,onChange:this.onFieldLabelChange}))),(0,e.jsx)("tr",null,(0,e.jsx)("td",null,(0,e.jsx)(i.Label,{className:"mt-2"},this.nls("showSeparator"))),(0,e.jsx)("td",{colSpan:2},(0,e.jsx)(i.Switch,{className:"separatorSwitch",role:"switch","aria-label":this.nls("showSeparator"),title:this.nls("showSeparator"),checked:this.state.showThousandSeparator,onChange:this.onSeparatorChange}))),(0,e.jsx)("tr",null,(0,e.jsx)("td",null,(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("noFormatting"),className:"cursor-pointer",value:"noFormatting",onChange:e=>{this.handleFormattingChange(e)},checked:"noFormatting"===this.state.formattingOptions}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer"},this.nls("noFormatting")))),(0,e.jsx)("td",null,(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("round"),className:"cursor-pointer",value:"round",onChange:e=>{this.handleFormattingChange(e)},checked:"round"===this.state.formattingOptions}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer"},this.nls("round")))),(0,e.jsx)("td",null,(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("truncate"),className:"cursor-pointer",value:"truncate",onChange:e=>{this.handleFormattingChange(e)},checked:"truncate"===this.state.formattingOptions}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer"},this.nls("truncate"))))),"noFormatting"!==this.state.formattingOptions&&(0,e.jsx)("tr",null,(0,e.jsx)("td",{tabIndex:0,"aria-label":this.nls("significantDigitsLabel")},(0,e.jsx)(i.Label,null,this.nls("significantDigitsLabel"))),(0,e.jsx)("td",{colSpan:2},(0,e.jsx)(i.NumericInput,{"aria-label":this.nls("significantDigitsLabel"),className:"significantDigitsLabel",size:"sm",min:0,max:10,defaultValue:this.state.significantDigit,value:this.state.significantDigit,onChange:this.onDigitsChange})))))))}}const xe=m(17e3);let be=[];class ve extends e.React.PureComponent{constructor(t){super(t),this.supportedDsTypes=(0,e.Immutable)([de.AllDataSourceTypes.FeatureLayer]),this.items=[],this.backRef=e.React.createRef(),this.colorSidePopperTrigger=e.React.createRef(),this.colorButtonRef=e.React.createRef(),this.addSummaryFieldsRef=e.React.createRef(),this.summaryFieldsSidePopperTrigger=e.React.createRef(),this.allSelectedLayers=[],this.defaultSelectedItem={name:""},this.nls=e=>{var t;const s=Object.assign({},n,i.defaultMessages);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{this.props.availableFeatureLayer.forEach(((e,t)=>{this.getLayerListProperty(e.id)})),this.setState({selectedLayers:this.allSelectedLayers}),this.editValueUpdate()},this.getLayerListProperty=e=>{const t=c(e);if(t){const e={label:t.getLabel(),layer:{layerDsId:t.id}};this.allSelectedLayers.push(e)}},this.componentDidUpdate=e=>{this.props.editCurrentLayer.layerDsId===e.editCurrentLayer.layerDsId&&this.props.analysisIndex===e.analysisIndex&&this.props.analysisList===e.analysisList||this.editValueUpdate()},this.intersectedAreaLengthField=(e,t)=>(e.push({fieldLabel:t.fieldLabel,fieldColor:t.fieldColor,summaryFieldInfo:{summaryBy:t.summaryFieldInfo.summaryBy,showSeparator:t.summaryFieldInfo.showSeparator,numberFormattingOption:t.summaryFieldInfo.numberFormattingOption,significantDigits:t.summaryFieldInfo.significantDigits}}),e),this.setSummaryValues=e=>{let t=[];e.summaryFields.forEach((e=>{var s,i;this.setState({singleColorFields:e.fieldColor}),(null===(s=e.summaryFieldInfo)||void 0===s?void 0:s.summaryBy)===B.SumOfIntersectedArea?(t=this.intersectedAreaLengthField(t,e),this.setState({sumOfAreaLabel:e.fieldLabel,sumOfArea:!0,intersectedSummaryFieldList:t})):(null===(i=e.summaryFieldInfo)||void 0===i?void 0:i.summaryBy)===B.SumOfIntersectedLength?(t=this.intersectedAreaLengthField(t,e),this.setState({sumOfLengthLabel:e.fieldLabel,sumOfLength:!0,intersectedSummaryFieldList:t})):be.push({fieldLabel:e.fieldLabel,fieldColor:e.fieldColor,summaryFieldInfo:e.summaryFieldInfo})}))},this.editValueUpdate=()=>{be=[],this.getFieldsDs(this.props.editCurrentLayer.layerDsId),this.props.analysisList.forEach(((e,t)=>{var s;const i=e.analysisInfo,a=c(e.useDataSource.dataSourceId);if(e.useDataSource.dataSourceId===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===L.Closest&&this.props.analysisIndex===t){const t=""!==i.distanceUnit?i.distanceUnit:b();return this.setState({closestAnalysisType:!0,proximityAnalysisType:!1,summaryAnalysisType:!1,useDataSource:e.useDataSource,layerLabel:e.label,analysisType:e.analysisInfo.analysisType,closestFeatureMaxDistance:i.closestFeatureMaxDistance,distanceUnit:t,expandOnOpen:i.expandOnOpen}),!0}if(e.useDataSource.dataSourceId===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===L.Proximity&&this.props.analysisIndex===t)return this.setState({closestAnalysisType:!1,proximityAnalysisType:!0,summaryAnalysisType:!1,useDataSource:e.useDataSource,layerLabel:e.label,analysisType:e.analysisInfo.analysisType,displayField:i.displayField?[i.displayField]:[x(a.layerDefinition)],sortFeaturesByDistance:i.sortFeaturesByDistance,sortFeaturesField:i.sortFeatures.sortFeaturesByField?[i.sortFeatures.sortFeaturesByField]:[],sortFeaturesFieldOrder:i.sortFeatures.sortFeaturesOrder,isGroupFeatures:i.groupFeaturesEnabled,groupFeaturesField:i.groupFeatures.groupFeaturesByField?[i.groupFeatures.groupFeaturesByField]:[],groupFeaturesFieldOrder:i.groupFeatures.groupFeaturesOrder,isSortGroupsByCount:i.sortGroupsByCount,expandOnOpen:i.expandOnOpen,expandFeatureDetails:i.expandFeatureDetails,highlightResultsOnMap:i.highlightResultsOnMap}),!0;if(e.useDataSource.dataSourceId===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===L.Summary&&this.props.analysisIndex===t){this.setEditIndex=t;const a=c(this.props.editCurrentLayer.layerDsId);return this.updateSummaryFieldListSettings=i.summaryFields,i.summaryFields.length>0&&this.setSummaryValues(i),this.setState({closestAnalysisType:!1,proximityAnalysisType:!1,summaryAnalysisType:!0,useDataSource:e.useDataSource,layerLabel:e.label,analysisType:e.analysisInfo.analysisType,singleColorMode:i.isSingleColorMode,singleColorFields:i.summaryFields.length>0?i.singleFieldColor:N,summaryFieldsList:be,selectedLayerGeometry:null===(s=null==a?void 0:a.layerDefinition)||void 0===s?void 0:s.geometryType,expandOnOpen:i.expandOnOpen,highlightResultsOnMap:i.highlightResultsOnMap}),!0}}))},this.updateItemValue=(e,t)=>{let s;this.props.analysisList.some(((i,a)=>{const n=c((null==t?void 0:t.dataSourceId)?t.dataSourceId:this.props.editCurrentLayer.layerDsId);return i.useDataSource.dataSourceId!==(null==t?void 0:t.dataSourceId)&&!this.props.editCurrentLayer.layerDsId||this.state.analysisType!==L.Closest||this.props.analysisIndex!==a?i.useDataSource.dataSourceId!==(null==t?void 0:t.dataSourceId)&&!this.props.editCurrentLayer.layerDsId||this.state.analysisType!==L.Proximity||this.props.analysisIndex!==a?i.useDataSource.dataSourceId!==(null==t?void 0:t.dataSourceId)&&!this.props.editCurrentLayer.layerDsId||this.state.analysisType!==L.Summary||this.props.analysisIndex!==a?void 0:(this.setEditIndex=a,this.updateSummaryFieldListSettings=this.state.summaryFieldsList.concat(this.state.intersectedSummaryFieldList),s={useDataSource:t||i.useDataSource,label:e||i.label,analysisInfo:{analysisType:this.state.analysisType,isSingleColorMode:this.state.singleColorMode,singleFieldColor:this.state.singleColorFields,summaryFields:this.updateSummaryFieldListSettings,expandOnOpen:this.state.expandOnOpen,highlightResultsOnMap:this.state.highlightResultsOnMap}},!0):(this.setEditIndex=a,s={useDataSource:t||i.useDataSource,label:e||i.label,analysisInfo:{analysisType:this.state.analysisType,displayField:this.state.displayField.length>0?this.state.displayField[0]:x(n.layerDefinition),sortFeaturesByDistance:this.state.sortFeaturesByDistance,sortFeatures:{sortFeaturesByField:this.state.sortFeaturesField.length>0?this.state.sortFeaturesField[0]:"",sortFeaturesOrder:this.state.sortFeaturesFieldOrder},groupFeaturesEnabled:this.state.isGroupFeatures,groupFeatures:{groupFeaturesByField:this.state.groupFeaturesField.length>0?this.state.groupFeaturesField[0]:"",groupFeaturesOrder:this.state.groupFeaturesFieldOrder},sortGroupsByCount:this.state.isSortGroupsByCount,expandOnOpen:this.state.expandOnOpen,expandFeatureDetails:this.state.expandFeatureDetails,highlightResultsOnMap:this.state.highlightResultsOnMap}},!0):(this.setEditIndex=a,s={useDataSource:t||i.useDataSource,label:e||i.label,analysisInfo:{analysisType:this.state.analysisType,closestFeatureMaxDistance:this.state.closestFeatureMaxDistance,distanceUnit:this.state.distanceUnit?this.state.distanceUnit:M.distanceUnit,expandOnOpen:this.state.expandOnOpen}},!0)})),this.updateItem(this.setEditIndex,s,(null==t?void 0:t.dataSourceId)||this.props.editCurrentLayer.layerDsId,this.state.analysisType)},this.updateItem=(e,t,s,i)=>{const a=e;a>-1&&this.setState({analysisListSettings:[...this.props.analysisList.slice(0,a),Object.assign({},this.props.analysisList[a],t),...this.props.analysisList.slice(a+1)]},(()=>{this.props.onAnalysisUpdate(this.state.analysisListSettings,s,i,a)}))},this.onAnalysisTypeChange=e=>{e.target.value===L.Closest?this.setState({closestAnalysisType:!0,proximityAnalysisType:!1,summaryAnalysisType:!1,expandOnOpen:!0}):e.target.value===L.Proximity?this.setState({closestAnalysisType:!1,proximityAnalysisType:!0,summaryAnalysisType:!1,expandOnOpen:!1,expandFeatureDetails:!1}):this.setState({closestAnalysisType:!1,proximityAnalysisType:!1,summaryAnalysisType:!0,expandOnOpen:!1}),this.resetAnalysisValues(this.state.useDataSource),this.setState({analysisType:e.target.value},(()=>{this.updateItemValue()}))},this.onLayerLabelChange=e=>{if(null==e?void 0:e.target){const t=e.target.value;this.setState({layerLabel:t})}},this.onLayerLabelAcceptValue=e=>{this.updateItemValue(e)},this.onMaxDistanceChange=e=>{this.setState({closestFeatureMaxDistance:null!=e?e:0},(()=>{this.updateItemValue()}))},this.onUnitChange=e=>{const t=f(this.state.closestFeatureMaxDistance,e.target.value);this.setState({distanceUnit:e.target.value,closestFeatureMaxDistance:t},(()=>{this.updateItemValue()}))},this.handleSortFeaturesOptionsChange=e=>{this.setState({sortFeaturesByDistance:e},(()=>{this.updateItemValue()}))},this.onDisplayField=e=>{0===e.length?this.setState({displayField:[]},(()=>{this.updateItemValue()})):this.setState({displayField:[e[0].jimuName]},(()=>{this.updateItemValue()}))},this.onSortFieldSelectChange=e=>{0===e.length?this.setState({sortFeaturesField:[]},(()=>{this.updateItemValue()})):this.setState({sortFeaturesField:[e[0].jimuName]},(()=>{this.updateItemValue()}))},this.onGroupFieldSelectChange=e=>{0===e.length?this.setState({groupFeaturesField:[]},(()=>{this.updateItemValue()})):this.setState({groupFeaturesField:[e[0].jimuName]},(()=>{this.updateItemValue()}))},this.expandListOnChange=e=>{!e.target.checked&&this.state.proximityAnalysisType&&this.setState({expandFeatureDetails:!1}),this.setState({expandOnOpen:e.target.checked},(()=>{this.updateItemValue()}))},this.resetAnalysisValues=t=>{var s;const i=c(t.dataSourceId);this.setState({closestFeatureMaxDistance:M.closestFeatureMaxDistance,distanceUnit:null,displayField:[],sortFeaturesByDistance:!0,sortFeaturesField:[],sortFeaturesFieldOrder:e.OrderRule.Asc,isGroupFeatures:!1,groupFeaturesField:[],groupFeaturesFieldOrder:e.OrderRule.Asc,isSortGroupsByCount:!1,selectedLayerGeometry:null===(s=i.layerDefinition)||void 0===s?void 0:s.geometryType,sumOfLength:!1,sumOfArea:!1,summaryFieldsList:[],intersectedSummaryFieldList:[],sumOfAreaLabel:this.nls("sumOfIntersectedArea"),sumOfLengthLabel:this.nls("sumOfIntersectedLength")},(()=>{this.updateItemValue()}))},this.onAddSummaryFieldsClick=e=>{e.stopPropagation(),this.setState({isAddNewSummaryField:!0,isNewFieldAdded:!0,summaryEditIndex:null},(()=>{var e;null===(e=this.backRef.current)||void 0===e||e.backRefFocus()}))},this.editSummaryFields=(e,t,s)=>{e.stopPropagation(),this.setSidePopperAnchor(s),this.setState({isAddNewSummaryField:!0,isNewFieldAdded:!1,summaryEditField:t,summaryEditIndex:s},(()=>{var e;null===(e=this.backRef.current)||void 0===e||e.backRefFocus()}))},this.setSidePopperAnchor=e=>{const t=this.summaryFieldsSidePopperTrigger.current.getElementsByClassName("jimu-tree-item__body")[e];this.setState({popperFocusNode:t})},this.deleteSummaryFields=(e,t)=>{var s,i;let a;e.stopPropagation();const n=this.state.summaryFieldsList.concat(this.state.intersectedSummaryFieldList);n.splice(t,1),0===n.length?null===(s=this.addSummaryFieldsRef.current)||void 0===s||s.focus():null===(i=this.summaryFieldsSidePopperTrigger.current)||void 0===i||i.focus(),this.props.analysisList.forEach((e=>{const t=e.analysisInfo;e.useDataSource.dataSourceId===this.props.editCurrentLayer.layerDsId&&e.analysisInfo.analysisType===L.Summary&&(a={useDataSource:e.useDataSource,label:e.label,analysisInfo:{analysisType:e.analysisInfo.analysisType,isSingleColorMode:t.isSingleColorMode,singleFieldColor:t.singleFieldColor,summaryFields:n}})})),this.setState({analysisListSettings:this.props.analysisList},(()=>{this.updateItem(this.setEditIndex,a,this.props.editCurrentLayer.layerDsId,this.state.analysisType)}))},this.editExistingIntersectedSummaryField=(e,t,s,i)=>{let a;this.state.intersectedSummaryFieldList.forEach(((n,l)=>{a=this.updateSummaryIntersectedFields(e,t,s,i,n)})),this.state.summaryEditField.summaryFieldInfo.summaryBy===B.SumOfIntersectedArea?this.setState({sumOfAreaLabel:e}):this.state.summaryEditField.summaryFieldInfo.summaryBy===B.SumOfIntersectedLength&&this.setState({sumOfLengthLabel:e}),this.setState({intersectedSummaryFieldList:[...this.state.intersectedSummaryFieldList.slice(0,0),Object.assign({},this.state.intersectedSummaryFieldList[0],a),...this.state.intersectedSummaryFieldList.slice(1)]},(()=>{this.updateItemValue()}))},this.updateSummaryIntersectedFields=(e,t,s,i,a)=>{let n,l={};return"esriGeometryPolyline"===this.state.selectedLayerGeometry?n=B.SumOfIntersectedLength:"esriGeometryPolygon"===this.state.selectedLayerGeometry&&(n=B.SumOfIntersectedArea),l={fieldLabel:e,fieldColor:a.fieldColor,summaryFieldInfo:{summaryBy:n,showSeparator:t,numberFormattingOption:s,significantDigits:i}},l},this.onOkButtonClick=(e,t,s,i)=>{this.editExistingIntersectedSummaryField(e,t,s,i)},this.createFieldsOptionElement=(t,s)=>(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{tabIndex:0,"aria-label":t.fieldLabel,className:"text-truncate labelAlign",title:t.fieldLabel},t.fieldLabel),(0,e.jsx)(i.Button,{role:"button","aria-label":t.fieldLabel+this.nls("editExpression"),className:"ml-1",title:this.nls("editExpression"),icon:!0,type:"tertiary",size:"sm",onClick:e=>{this.editSummaryFields(e,t,s)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.editSummaryFields(e,t,s)}},(0,e.jsx)(Q,{size:"s"})),(0,e.jsx)(i.Button,{role:"button","aria-label":this.nls("deleteOption"),title:this.nls("deleteOption"),icon:!0,type:"tertiary",size:"sm",onClick:e=>{this.deleteSummaryFields(e,s)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.deleteSummaryFields(e,s)}},(0,e.jsx)($,{size:"s"}))),this.onEditPopperClose=()=>{this.setState({editSummaryAreaLengthFieldPopupOpen:!1})},this.updateSortedSummaryFields=e=>{this.setState({summaryFieldsList:e},(()=>{this.updateItemValue()}))},this.onColorSettingClick=()=>{this.openColorSetting(!0)},this.closeColorSettingsPanel=()=>{this.openColorSetting(!1),this.focusColorSetting()},this.focusColorSetting=()=>{setTimeout((()=>{var e;null===(e=this.colorButtonRef.current)||void 0===e||e.focus()}),50)},this.openColorSetting=e=>{this.setState({showSummaryColorSettings:e},(()=>{var e;null===(e=this.backRef.current)||void 0===e||e.backRefFocus(),setTimeout((()=>{var e;null===(e=this.colorSidePopperTrigger.current)||void 0===e||e.focus()}),50)}))},this.onUpdateFieldColorByCategory=e=>{var t,s;const i=null===(t=this.state.summaryFieldsList)||void 0===t?void 0:t.map(((t,s)=>{var i,a;return Object.assign(Object.assign({},t),{fieldColor:(null===(i=null==e?void 0:e[t.fieldLabel+"_"+s])||void 0===i?void 0:i._fillColor)?null===(a=null==e?void 0:e[t.fieldLabel+"_"+s])||void 0===a?void 0:a._fillColor:U[s%U.length]})})),a=null===(s=this.state.intersectedSummaryFieldList)||void 0===s?void 0:s.map(((t,s)=>{var i,a;return Object.assign(Object.assign({},t),{fieldColor:(null===(i=null==e?void 0:e[t.fieldLabel+"_"+this.state.summaryFieldsList.length])||void 0===i?void 0:i._fillColor)?null===(a=null==e?void 0:e[t.fieldLabel+"_"+this.state.summaryFieldsList.length])||void 0===a?void 0:a._fillColor:U[s%U.length]})}));this.setState({summaryFieldsList:i,intersectedSummaryFieldList:a,byCategoryColorFields:e},(()=>{this.updateItemValue()}))},this.handleColorTypeChange=e=>{e===P.SingleColor?this.updateFieldColorBySingleColor(this.state.singleColorFields):e===P.ByCategory&&this.onUpdateFieldColorByCategory(this.state.byCategoryColorFields),this.setState({singleColorMode:e===P.SingleColor},(()=>{this.updateItemValue()}))},this.handleSingleColorChange=e=>{this.setState({singleColorFields:e},(()=>{this.updateFieldColorBySingleColor(this.state.singleColorFields)}))},this.updateFieldColorBySingleColor=e=>{var t,s;const i=null===(t=this.state.summaryFieldsList)||void 0===t?void 0:t.map(((t,s)=>Object.assign(Object.assign({},t),{fieldColor:e}))),a=null===(s=this.state.intersectedSummaryFieldList)||void 0===s?void 0:s.map(((t,s)=>Object.assign(Object.assign({},t),{fieldColor:e})));this.setState({summaryFieldsList:i,intersectedSummaryFieldList:a},(()=>{this.updateItemValue()}))},this.handleByCategorySettingColorChange=()=>{this.openColorSetting(!0)},this.handleSortOrderKeyUp=t=>{"Enter"!==t.key&&" "!==t.key||this.setState({sortFeaturesFieldOrder:this.state.sortFeaturesFieldOrder===e.OrderRule.Asc?e.OrderRule.Desc:e.OrderRule.Asc},(()=>{this.updateItemValue()}))},this.handleGroupOrderKeyUp=t=>{"Enter"!==t.key&&" "!==t.key||this.setState({groupFeaturesFieldOrder:this.state.groupFeaturesFieldOrder===e.OrderRule.Asc?e.OrderRule.Desc:e.OrderRule.Asc},(()=>{this.updateItemValue()}))},this.getFieldsDs=e=>{var t;const s=[],i=c(e);s.push({layerDsId:e}),this.setState({selectedFieldsDataSource:s,selectedLayerGeometry:null===(t=i.layerDefinition)||void 0===t?void 0:t.geometryType})},this.createDisplayFieldOption=t=>{const s=c(t.layerDsId);return(0,e.jsx)(de.FieldSelector,{dataSources:s?[s]:[],isSearchInputHidden:!0,onChange:this.onDisplayField.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,e.Immutable)(this.state.displayField),isMultiple:!1})},this.createSortFieldSelectorOption=(t,s)=>{const a=c(t.layerDsId);return(0,e.jsx)("div",{className:"sort-field-section p-1"},(0,e.jsx)("div",{className:"sort-field-selector"},(0,e.jsx)(de.FieldSelector,{dataSources:a?[a]:[],isSearchInputHidden:!0,onChange:this.onSortFieldSelectChange.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,e.Immutable)(this.state.sortFeaturesField),isMultiple:!1,noSelectionItem:this.defaultSelectedItem,dropdownProps:{useKeyUpEvent:!0}})),(0,e.jsx)("div",{className:"sort-icon"},(0,e.jsx)(i.Button,{size:"sm",icon:!0,type:"tertiary",className:"order-button padding-0",title:this.state.sortFeaturesFieldOrder===e.OrderRule.Asc?this.nls("ascending"):this.nls("decending"),onKeyUp:e=>{this.handleSortOrderKeyUp(e)},onClick:()=>{this.setState({sortFeaturesFieldOrder:this.state.sortFeaturesFieldOrder===e.OrderRule.Asc?e.OrderRule.Desc:e.OrderRule.Asc},(()=>{this.updateItemValue()}))}},this.state.sortFeaturesFieldOrder===e.OrderRule.Desc&&(0,e.jsx)(ye,{size:"s",className:"sort-arrow-down-icon ml-0"}),this.state.sortFeaturesFieldOrder===e.OrderRule.Asc&&(0,e.jsx)(ce,{size:"s",className:"sort-arrow-down-icon ml-0"}))))},this.createGroupFieldSelectorOption=(t,s)=>{const a=c(t.layerDsId);return(0,e.jsx)("div",{className:"sort-field-section p-1"},(0,e.jsx)("div",{className:"sort-field-selector"},(0,e.jsx)(de.FieldSelector,{dataSources:a?[a]:[],isSearchInputHidden:!0,onChange:this.onGroupFieldSelectChange.bind(this),isDataSourceDropDownHidden:!0,useDropdown:!0,selectedFields:(0,e.Immutable)(this.state.groupFeaturesField),isMultiple:!1,noSelectionItem:this.defaultSelectedItem,dropdownProps:{useKeyUpEvent:!0}})),(0,e.jsx)("div",{className:"sort-icon"},(0,e.jsx)(i.Button,{size:"sm",icon:!0,type:"tertiary",className:"order-button padding-0",title:this.state.groupFeaturesFieldOrder===e.OrderRule.Asc?this.nls("ascending"):this.nls("decending"),onKeyUp:e=>{this.handleGroupOrderKeyUp(e)},onClick:()=>{this.setState({groupFeaturesFieldOrder:this.state.groupFeaturesFieldOrder===e.OrderRule.Asc?e.OrderRule.Desc:e.OrderRule.Asc},(()=>{this.updateItemValue()}))}},this.state.groupFeaturesFieldOrder===e.OrderRule.Desc&&(0,e.jsx)(ye,{size:"s",className:"sort-arrow-down-icon ml-0"}),this.state.groupFeaturesFieldOrder===e.OrderRule.Asc&&(0,e.jsx)(ce,{size:"s",className:"sort-arrow-down-icon ml-0"}))))},this.groupFeaturesOnChange=e=>{this.setState({isGroupFeatures:e.target.checked},(()=>{this.updateItemValue()}))},this.sortGroupsByCountOnChange=e=>{this.setState({isSortGroupsByCount:e.target.checked},(()=>{this.updateItemValue()}))},this.onSumOfAreaChange=(e,t)=>{this.updateIntersectedFields(e.target.checked,t),this.setState({sumOfArea:e.target.checked})},this.onSumOfLengthChange=(e,t)=>{this.updateIntersectedFields(e.target.checked,t),this.setState({sumOfLength:e.target.checked})},this.updateIntersectedFields=(e,t)=>{if(e){const e={fieldLabel:t===B.SumOfIntersectedLength?this.state.sumOfLengthLabel:this.state.sumOfAreaLabel,fieldColor:this.state.singleColorMode?this.state.singleColorFields:N,summaryFieldInfo:{summaryBy:t,showSeparator:!0,numberFormattingOption:E.NoFormatting,significantDigits:0}};this.setState({intersectedSummaryFieldList:[...this.state.intersectedSummaryFieldList.slice(0,0),Object.assign({},this.state.intersectedSummaryFieldList[0],e),...this.state.intersectedSummaryFieldList.slice(1)]},(()=>{this.state.singleColorMode?this.updateItemValue():this.onUpdateFieldColorByCategory(this.state.byCategoryColorFields)}))}else this.state.intersectedSummaryFieldList.splice(0,1),this.updateItemValue()},this.onSumOfAreaEditClick=e=>{this.onIntersectedFieldEdit(e)},this.onSumOfLengthEditClick=e=>{this.onIntersectedFieldEdit(e)},this.onIntersectedFieldEdit=e=>{this.setState({editSummaryAreaLengthFieldPopupOpen:!0,sumOfIntersectedFieldPopupTitle:e===B.SumOfIntersectedArea?this.nls("editSumOfIntersectedArea"):this.nls("editSumOfIntersectedLength")}),this.state.intersectedSummaryFieldList.forEach((t=>{t.summaryFieldInfo.summaryBy===e&&this.setState({summaryEditField:t})}))},this.closeAddSummaryFieldPanel=()=>{this.setState({isAddNewSummaryField:!1},(()=>{this.addSummaryFieldsRef.current.focus()}))},this.onExpressionInfoUpdate=e=>{this.setState({isAddNewSummaryField:!1});const t={fieldLabel:e.fieldLabel,fieldColor:this.state.singleColorMode?this.state.singleColorFields:N,summaryFieldInfo:e.selectedExpression};this.state.isNewFieldAdded?this.setState({summaryFieldsList:[...this.state.summaryFieldsList,t],expressionInfo:e.selectedExpression},(()=>{this.setSidePopperAnchor(this.state.summaryFieldsList.length-1),this.state.singleColorMode?this.updateItemValue():this.onUpdateFieldColorByCategory(this.state.byCategoryColorFields)})):this.setState({expressionInfo:e.selectedExpression},(()=>{this.updateExistingField(t)}))},this.updateExistingField=e=>{const t=this.state.summaryEditIndex;t>-1&&this.setState({summaryFieldsList:[...this.state.summaryFieldsList.slice(0,t),Object.assign({},this.state.summaryFieldsList[t],e),...this.state.summaryFieldsList.slice(t+1)]},(()=>{this.state.singleColorMode?this.updateItemValue():this.onUpdateFieldColorByCategory(this.state.byCategoryColorFields)}))},this.getDsRootIdsByWidgetId=()=>{var t,s;const i=[],a=(null===(s=null===(t=(0,e.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===s?void 0:s.appConfig).dataSources[this.props.activeDs];return(null==a?void 0:a.type)!==e.ArcGISDataSourceTypes.WebMap&&(null==a?void 0:a.type)!==e.ArcGISDataSourceTypes.WebScene||i.push(this.props.activeDs),i.length>0?(0,e.Immutable)(i):void 0},this.dataSourceChangeSave=e=>{var t;if(!e)return;const s=null===(t=this.props)||void 0===t?void 0:t.availableFeatureLayer.find((t=>t.id===e[0].dataSourceId));this.resetAnalysisValues(e[0]),this.setState({layerLabel:(null==s?void 0:s.getLabel())?s.getLabel():"",useDataSource:e[0]},(()=>{this.updateItemValue(this.state.layerLabel,this.state.useDataSource)}))},this.expandFeatureOnChange=e=>{this.setState({expandFeatureDetails:e.target.checked},(()=>{this.updateItemValue()}))},this.highlightResultsOnMapOnChange=e=>{this.setState({highlightResultsOnMap:e.target.checked},(()=>{this.updateItemValue()}))},this.state={closestAnalysisType:!1,proximityAnalysisType:!1,summaryAnalysisType:!1,analysisListSettings:this.props.analysisList||[],selectedLayers:[],useDataSource:null,layerLabel:"",analysisType:"",closestFeatureMaxDistance:M.closestFeatureMaxDistance,displayField:[],distanceUnit:"",sortFeaturesByDistance:!0,sortFeaturesField:[],sortFeaturesFieldOrder:e.OrderRule.Asc,selectedFieldsDataSource:[],isGroupFeatures:!1,groupFeaturesField:[],groupFeaturesFieldOrder:e.OrderRule.Asc,isSortGroupsByCount:!1,expandOnOpen:!1,editSummaryAreaLengthFieldPopupOpen:!1,sumOfArea:!1,sumOfLength:!1,sumOfAreaLabel:this.nls("sumOfIntersectedArea"),sumOfLengthLabel:this.nls("sumOfIntersectedLength"),selectedLayerGeometry:this.props.selectedLayerGeometry,summaryFieldsList:[],intersectedSummaryFieldList:[],summaryEditIndex:null,summaryEditField:null,expressionInfo:null,sumOfIntersectedFieldPopupTitle:"",isAddNewSummaryField:!1,isNewFieldAdded:!1,showSummaryColorSettings:!1,singleColorFields:N,byCategoryColorFields:null,singleColorMode:!0,popperFocusNode:null,expandFeatureDetails:!1,highlightResultsOnMap:!0},this.setEditIndex=0,this.defaultSelectedItem.name=this.nls("noSelectionItemLabel"),this.updateSummaryFieldListSettings=[]}render(){var s,a,n,o,d,h;const p=e.DataSourceManager.getInstance().getDataSource(this.props.activeDs).getChildDataSources();let c=!1;const u=[];p&&p.forEach((t=>{var s;"Table"!==(null===(s=null==t?void 0:t.layerDefinition)||void 0===s?void 0:s.type)&&((null==t?void 0:t.type)===e.DataSourceTypes.MapService||(null==t?void 0:t.type)===e.DataSourceTypes.GroupLayer?t.getChildDataSources().forEach((e=>{u.push(e.id)})):u.length>0?(u.find((e=>e.id===t.id))||(c=!0),c&&u.push(t.id)):u.push(t.id))}));const m={fromRootDsIds:this.getDsRootIdsByWidgetId(),fromDsIds:(0,e.Immutable)(u)};return(0,e.jsx)("div",{css:l(this.props.theme),style:{height:"calc(100% - 56px)",width:"100%",overflow:"auto"}},(0,e.jsx)(t.SettingSection,null,(0,e.jsx)(t.SettingRow,{label:this.nls("selectLayer"),flow:"wrap"},(0,e.jsx)(de.DataSourceSelector,{types:this.supportedDsTypes,useDataSources:this.state.useDataSource?(0,e.Immutable)([this.state.useDataSource]):(0,e.Immutable)([]),fromRootDsIds:m.fromRootDsIds,fromDsIds:m.fromDsIds,mustUseDataSource:!0,onChange:this.dataSourceChangeSave,enableToSelectOutputDsFromSelf:!1,closeDataSourceListOnChange:!0,hideAddDataButton:!0,disableRemove:()=>!0,hideDataView:!0,useDataSourcesEnabled:!0})),(0,e.jsx)(t.SettingRow,{label:this.nls("label"),flow:"wrap"},(0,e.jsx)(i.TextInput,{className:"w-100",role:"textbox","aria-label":this.nls("label")+this.state.layerLabel,title:this.state.layerLabel,size:"sm",value:this.state.layerLabel,onAcceptValue:this.onLayerLabelAcceptValue,onChange:this.onLayerLabelChange}))),(0,e.jsx)(t.SettingSection,null,(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-1"},this.nls("analysisTypeLabel"))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("analysisTypeInfoTooltip"),title:this.nls("analysisTypeInfoTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 d-inline"},(0,e.jsx)(I,null)))),(0,e.jsx)(t.SettingRow,{className:"mt-2"},(0,e.jsx)(i.Select,{menuRole:"menu","aria-label":this.nls("analysisTypeLabel")+this.state.analysisType,name:"analysisType",size:"sm",value:this.state.analysisType,onChange:this.onAnalysisTypeChange},T.map(((t,s)=>(0,e.jsx)(i.Option,{role:"option",tabIndex:0,"aria-label":this.nls(t),key:s,value:t},this.nls(t)))))),this.state.closestAnalysisType&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingRow,{label:this.nls("closestFeatureMaxDistLabel"),flow:"wrap"},(0,e.jsx)(i.NumericInput,{className:"w-100","aria-label":this.nls("closestFeatureMaxDistLabel"),size:"sm",min:0,max:g(this.state.distanceUnit),defaultValue:this.state.closestFeatureMaxDistance,value:this.state.closestFeatureMaxDistance,onChange:this.onMaxDistanceChange})),(0,e.jsx)(t.SettingRow,{label:this.nls("distanceUnits"),flow:"wrap"},(0,e.jsx)(i.Select,{menuRole:"menu","aria-label":this.state.distanceUnit,name:"analysisType",size:"sm",value:this.state.distanceUnit,onChange:this.onUnitChange},D.map(((t,s)=>(0,e.jsx)(i.Option,{role:"option",tabIndex:0,"aria-label":t.value,key:s,value:t.value},t.label)))))),this.state.proximityAnalysisType&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingRow,{label:this.nls("displayFieldLabel"),flow:"wrap"},this.createDisplayFieldOption(this.state.selectedFieldsDataSource[0])),(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("sortFeaturesLabel"),title:this.nls("sortFeaturesLabel"),className:"w-100 d-flex"},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 setting-text-level-3"},this.nls("sortFeaturesLabel")))),(0,e.jsx)(t.SettingRow,{className:"mt-1 ml-3",flow:"wrap"},(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("distanceLabel"),className:"cursor-pointer",value:"distanceLabel",onChange:()=>{this.handleSortFeaturesOptionsChange(!0)},checked:this.state.sortFeaturesByDistance}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleSortFeaturesOptionsChange(!0)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleSortFeaturesOptionsChange(!0)}},this.nls("distanceLabel")))),(0,e.jsx)(t.SettingRow,{className:"mt-2 ml-3",flow:"wrap"},(0,e.jsx)(i.Label,{className:"m-0",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("field"),className:"cursor-pointer",value:"field",onChange:()=>{this.handleSortFeaturesOptionsChange(!1)},checked:!this.state.sortFeaturesByDistance}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleSortFeaturesOptionsChange(!1)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleSortFeaturesOptionsChange(!1)}},this.nls("field")))),!this.state.sortFeaturesByDistance&&(0,e.jsx)(H.List,{className:"pt-3 pb-3",size:"sm",itemsJson:null===(s=Array.from(this.state.selectedFieldsDataSource))||void 0===s?void 0:s.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`}))),dndEnabled:!1,overrideItemBlockInfo:({itemBlockInfo:e})=>({name:H.TreeItemActionType.RenderOverrideItem,children:[{name:H.TreeItemActionType.RenderOverrideItemBody,children:[{name:H.TreeItemActionType.RenderOverrideItemMainLine}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createSortFieldSelectorOption(i.itemStateDetailContent,a.indexOf(i))}}),(0,e.jsx)(t.SettingRow,{label:this.nls("groupFeaturesLabel")},(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("groupFeaturesLabel"),title:this.nls("groupFeaturesLabel"),checked:this.state.isGroupFeatures,onChange:this.groupFeaturesOnChange})),this.state.isGroupFeatures&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(H.List,{className:"pt-3 pb-3",size:"sm",itemsJson:null===(a=Array.from(this.state.selectedFieldsDataSource))||void 0===a?void 0:a.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`}))),dndEnabled:!1,overrideItemBlockInfo:({itemBlockInfo:e})=>({name:H.TreeItemActionType.RenderOverrideItem,children:[{name:H.TreeItemActionType.RenderOverrideItemBody,children:[{name:H.TreeItemActionType.RenderOverrideItemMainLine}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createGroupFieldSelectorOption(i.itemStateDetailContent,a.indexOf(i))}}),(0,e.jsx)(t.SettingRow,{label:this.nls("sortGroupsByCount")},(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("sortGroupsByCount"),title:this.nls("sortGroupsByCount"),checked:this.state.isSortGroupsByCount,onChange:this.sortGroupsByCountOnChange})))),this.state.summaryAnalysisType&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{tabIndex:-1,className:"pt-2 pb-1"},(0,e.jsx)("div",{ref:this.addSummaryFieldsRef,tabIndex:0,"aria-label":this.nls("addSummaryFields"),title:this.nls("addSummaryFields"),className:"d-flex align-items-center add-summary-field",onClick:e=>{this.onAddSummaryFieldsClick(e)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.onAddSummaryFieldsClick(e)}},(0,e.jsx)("div",{tabIndex:-1,className:"add-summary-field-icon-container d-flex align-items-center justify-content-center mr-2"},(0,e.jsx)(i.Icon,{tabIndex:-1,icon:xe,size:12})),(0,e.jsx)("div",{tabIndex:-1,className:"text-truncate flex-grow-1"},this.nls("addSummaryFields")))),this.state.summaryFieldsList.length>0&&(0,e.jsx)("div",{ref:this.summaryFieldsSidePopperTrigger,className:(0,e.classNames)("nearme-summary-fields-list-items","esriGeometryPoint"===this.state.selectedLayerGeometry?"pb-2":"")},(0,e.jsx)(H.List,{itemsJson:null===(n=Array.from(this.state.summaryFieldsList||null))||void 0===n?void 0:n.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`}))),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:s}=t.props,[,i]=s,a=i.map((e=>e.itemStateDetailContent));this.updateSortedSummaryFields(a)},overrideItemBlockInfo:({itemBlockInfo:e})=>({name:H.TreeItemActionType.RenderOverrideItem,children:[{name:H.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:H.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:H.TreeItemActionType.RenderOverrideItemBody,children:[{name:H.TreeItemActionType.RenderOverrideItemDragHandle},{name:H.TreeItemActionType.RenderOverrideItemMainLine}]}]}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createFieldsOptionElement(i.itemStateDetailContent,a.indexOf(i))}})),("esriGeometryPolyline"===this.state.selectedLayerGeometry||"esriGeometryPolygon"===this.state.selectedLayerGeometry)&&(0,e.jsx)(t.SettingRow,{label:"esriGeometryPolyline"===this.state.selectedLayerGeometry?this.nls("sumOfIntersectedLength"):"esriGeometryPolygon"===this.state.selectedLayerGeometry?this.nls("sumOfIntersectedArea"):""},(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":"esriGeometryPolyline"===this.state.selectedLayerGeometry?this.nls("sumOfLengthTooltip"):"esriGeometryPolygon"===this.state.selectedLayerGeometry?this.nls("sumOfAreaTooltip"):"",title:"esriGeometryPolyline"===this.state.selectedLayerGeometry?this.nls("sumOfLengthTooltip"):"esriGeometryPolygon"===this.state.selectedLayerGeometry?this.nls("sumOfAreaTooltip"):"",showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 ml-2 d-inline"},(0,e.jsx)(I,null)))),"esriGeometryPolyline"===this.state.selectedLayerGeometry&&(0,e.jsx)("div",{className:(0,e.classNames)("pb-2 d-flex align-items-center justify-content-between")},(0,e.jsx)(i.Label,{title:this.state.sumOfLengthLabel,className:"pt-2 pl-1 text-truncate cursor-pointer"},(0,e.jsx)(i.Checkbox,{className:"mr-2 font-13",checked:this.state.sumOfLength,role:"checkbox","aria-label":this.nls("sumOfIntersectedLength"),onChange:e=>{this.onSumOfLengthChange(e,B.SumOfIntersectedLength)}}),this.state.sumOfLengthLabel),this.state.sumOfLength&&(0,e.jsx)(i.Button,{role:"button","aria-label":this.nls("edit"),title:this.nls("edit"),icon:!0,type:"tertiary","aria-haspopup":"dialog",size:"sm",onClick:()=>{this.onSumOfLengthEditClick(B.SumOfIntersectedLength)}},(0,e.jsx)(Q,{size:"s"}))),"esriGeometryPolygon"===this.state.selectedLayerGeometry&&(0,e.jsx)("div",{className:(0,e.classNames)("pb-2 d-flex align-items-center justify-content-between")},(0,e.jsx)(i.Label,{title:this.state.sumOfAreaLabel,className:"pt-2 pl-1 text-truncate cursor-pointer"},(0,e.jsx)(i.Checkbox,{className:"mr-2 font-13",checked:this.state.sumOfArea,role:"checkbox","aria-label":this.nls("sumOfIntersectedArea"),onChange:e=>{this.onSumOfAreaChange(e,B.SumOfIntersectedArea)}}),this.state.sumOfAreaLabel),this.state.sumOfArea&&(0,e.jsx)(i.Button,{role:"button","aria-label":this.nls("edit"),title:this.nls("edit"),icon:!0,type:"tertiary","aria-haspopup":"dialog",size:"sm",onClick:()=>{this.onSumOfAreaEditClick(B.SumOfIntersectedArea)}},(0,e.jsx)(Q,{size:"s"}))),(null===(o=this.updateSummaryFieldListSettings)||void 0===o?void 0:o.length)>0&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingRow,{className:(0,e.classNames)("pt-3",this.state.summaryFieldsList.length>0||this.state.sumOfArea||this.state.sumOfLength?"pt-2 nearme-divider":""),label:this.nls("themeSettingColorMode"),flow:"wrap"}),(0,e.jsx)(t.SettingRow,{className:"mt-0",flow:"wrap"},(0,e.jsx)(i.Label,{className:"mt-1 colorModesWidth",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("singleColor"),className:"cursor-pointer",value:"singleColor",onChange:()=>{this.handleColorTypeChange(P.SingleColor)},checked:this.state.singleColorMode}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleColorTypeChange(P.SingleColor)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleColorTypeChange(P.SingleColor)}},this.nls("singleColor"))),this.state.singleColorMode&&(0,e.jsx)(v.ThemeColorPicker,{specificTheme:(0,w.getTheme2)(),value:this.state.singleColorFields,onChange:e=>{this.handleSingleColorChange(e)}})),(0,e.jsx)(t.SettingRow,{className:"mt-0",flow:"wrap"},(0,e.jsx)(i.Label,{className:"mt-1 mb-1 colorModesWidth",centric:!0},(0,e.jsx)(i.Radio,{role:"radio","aria-label":this.nls("byCategory"),className:"cursor-pointer",value:"byCategory",onChange:()=>{this.handleColorTypeChange(P.ByCategory)},checked:!this.state.singleColorMode}),(0,e.jsx)("div",{tabIndex:0,className:"ml-1 text-break cursor-pointer",onClick:()=>{this.handleColorTypeChange(P.ByCategory)},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||this.handleColorTypeChange(P.ByCategory)}},this.nls("byCategory"))),!this.state.singleColorMode&&(0,e.jsx)(i.Button,{ref:this.colorButtonRef,role:"button","aria-label":this.nls("byCategory"),title:this.nls("byCategory"),icon:!0,type:"tertiary",size:"sm",onClick:this.handleByCategorySettingColorChange.bind(this)},(0,e.jsx)(te,null)))),(0,e.jsx)(t.SidePopper,{isOpen:this.state.isAddNewSummaryField&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.closeAddSummaryFieldPanel,trigger:null===(d=this.summaryFieldsSidePopperTrigger)||void 0===d?void 0:d.current,backToFocusNode:this.state.popperFocusNode},(0,e.jsx)("div",{className:"bg-light-300 border-color-gray-400",css:r(this.props.theme)},(0,e.jsx)(ne,{theme:this.props.theme,intl:this.props.intl,title:null!==this.state.summaryEditIndex?this.nls("editSummaryField"):this.nls("addSummaryFields"),ref:this.backRef,onBack:this.closeAddSummaryFieldPanel},(0,e.jsx)(fe,{intl:this.props.intl,theme:this.props.theme,widgetId:this.props.widgetId,currentLayerDsId:this.props.editCurrentLayer,fieldsEditIndex:this.state.summaryEditIndex,editingField:this.state.summaryEditField,expressionInfoUpdate:this.onExpressionInfoUpdate.bind(this)})))),(0,e.jsx)(t.SidePopper,{isOpen:this.state.showSummaryColorSettings&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.closeColorSettingsPanel,trigger:null===(h=this.colorSidePopperTrigger)||void 0===h?void 0:h.current},(0,e.jsx)("div",{className:"bg-light-300 border-color-gray-400",css:r(this.props.theme)},(0,e.jsx)(ne,{theme:this.props.theme,intl:this.props.intl,title:this.nls("summaryFieldColor"),ref:this.backRef,onBack:this.closeColorSettingsPanel},(0,e.jsx)("div",{className:"setting-container"},(0,e.jsx)(oe,{intl:this.props.intl,theme:this.props.theme,summaryFieldsInfo:this.updateSummaryFieldListSettings,updateFieldColorsValues:this.onUpdateFieldColorByCategory}))))),this.state.editSummaryAreaLengthFieldPopupOpen&&(0,e.jsx)(Se,{theme:this.props.theme,intl:this.props.intl,isOpen:this.state.editSummaryAreaLengthFieldPopupOpen,editSummaryFields:this.state.summaryEditField,sumOfIntersectedFieldPopupTitle:this.state.sumOfIntersectedFieldPopupTitle,onClose:this.onEditPopperClose,onOkClick:this.onOkButtonClick})),(this.state.proximityAnalysisType||this.state.summaryAnalysisType)&&(0,e.jsx)(t.SettingRow,{label:this.nls("highlightResultsOnMapLabel")},(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("highlightResultsOnMapLabel"),title:this.nls("highlightResultsOnMapLabel"),checked:this.state.highlightResultsOnMap,onChange:this.highlightResultsOnMapOnChange})),(0,e.jsx)(t.SettingRow,{label:this.nls("expandOnOpen")},(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("expandOnOpen"),title:this.nls("expandOnOpen"),checked:this.state.expandOnOpen,onChange:this.expandListOnChange})),this.state.proximityAnalysisType&&this.state.expandOnOpen&&(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(i.Label,{title:this.nls("expandFeatureDetails"),className:"m-0 w-100",centric:!0},(0,e.jsx)(i.Checkbox,{className:"mr-2 font-13",checked:this.state.expandFeatureDetails,role:"checkbox","aria-label":this.nls("expandFeatureDetails"),onChange:e=>{this.expandFeatureOnChange(e)}}),(0,e.jsx)("div",{className:"ml-1 w-100 text-break",onClick:e=>{"span"!==e.target.tagName.toLowerCase()&&e.preventDefault()}},(0,e.jsx)("span",{className:"cursor-pointer"},this.nls("expandFeatureDetails"))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("expandListTooltip"),title:this.nls("expandListTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 d-inline",onClick:e=>{e.preventDefault()}},(0,e.jsx)(I,null)))))))}}let Fe=[];class Ce extends e.React.PureComponent{constructor(t){var s,i,l,r;super(t),this.analysisLayersPopperTrigger=e.React.createRef(),this.backRef=e.React.createRef(),this.mvManager=a.MapViewManager.getInstance(),this.allDsLayers=[],this.nls=t=>{const s=Object.assign({},n,e.defaultMessages);return this.props.intl&&this.props.intl.formatMessage?this.props.intl.formatMessage({id:t,defaultMessage:s[t]}):s[t]},this.componentDidMount=()=>{var e,t;Fe=this.collectionOfLayerInfos();const s=[];(null===(e=this.props.activeDsLayersConfig)||void 0===e?void 0:e.layersInfo.length)>0&&(null===(t=this.props.activeDsLayersConfig)||void 0===t||t.layersInfo.map((e=>(s.push(e),!0))),this.setState({newAddedLayerAnalysis:s}))},this.onlyShowResultsOptionChange=e=>{this.setState({showLayersResultOption:e.target.checked},(()=>{this.props.onAnalysisSettingsUpdated("onlyShowLayersResult",this.state.showLayersResultOption)}))},this.displayFeatureCountStateChange=e=>{this.setState({displayFeatureCount:e.target.checked},(()=>{this.props.onAnalysisSettingsUpdated("displayFeatureCount",this.state.displayFeatureCount)}))},this.displayAnalysisIconStateChange=e=>{this.setState({displayAnalysisIcon:e.target.checked},(()=>{this.props.onAnalysisSettingsUpdated("displayAnalysisIcon",this.state.displayAnalysisIcon)}))},this.collectionOfLayerInfos=()=>{const e=[];this.props.allFeatureLayers.forEach(((e,t)=>{e.value===this.props.selectedDs&&e.availableLayers.forEach((e=>{const t=c(e.layerDsId);this.allDsLayers.push(t)}))}));for(let t=0;t<this.allDsLayers.length;t++)for(let s=0;s<T.length;s++)e.push({analysisType:T[s],featureLayer:this.allDsLayers[t]});return e},this.onAddAnalysisClick=()=>{var e,t,s,i,a,n;if((null===(e=this.props.activeDsLayersConfig)||void 0===e?void 0:e.layersInfo.length)>0){const e=[];for(let t=0;t<Fe.length;t++)for(let s=0;s<this.state.newAddedLayerAnalysis.length;s++)Fe[t].analysisType===this.state.newAddedLayerAnalysis[s].analysisInfo.analysisType&&Fe[t].featureLayer.id===this.state.newAddedLayerAnalysis[s].useDataSource.dataSourceId&&e.push(t);const l=[];Fe.forEach(((t,s)=>{e.includes(s)||l.push(s)}));const r={dataSourceId:null===(s=null===(t=Fe[null==l?void 0:l[0]])||void 0===t?void 0:t.featureLayer)||void 0===s?void 0:s.id,mainDataSourceId:null===(a=null===(i=Fe[null==l?void 0:l[0]])||void 0===i?void 0:i.featureLayer)||void 0===a?void 0:a.id,rootDataSourceId:this.props.selectedDs};let o=[];if(o=Object.assign(o,this.useDataSources),o.push(r),this.useDataSources=o,l.length>0){const e=R.find((e=>e.analysisType===Fe[l[0]].analysisType)),t=c(Fe[l[0]].featureLayer.id),s={useDataSource:r,label:t.getLabel(),analysisInfo:e};if(Fe[l[0]].analysisType===L.Proximity){const e=s.analysisInfo;e.displayField=x(t.layerDefinition),s.analysisInfo=e}this.setState({newAddedLayerAnalysis:[...this.state.newAddedLayerAnalysis,s],analysisIndex:this.state.newAddedLayerAnalysis.length,editCurrentLayer:{layerDsId:Fe[l[0]].featureLayer.id,analysisType:Fe[l[0]].analysisType},selectedLayerGeometryType:null===(n=t.layerDefinition)||void 0===n?void 0:n.geometryType},(()=>{this.props.onAnalysisSettingsUpdated("layersInfo",this.state.newAddedLayerAnalysis)})),this.setState({showEditAnalysisPopper:!0})}else this.displayDefaultClosestAnalysis(Fe,!0)}else this.displayDefaultClosestAnalysis(Fe,!1);setTimeout((()=>{this.props.getAddedLayersInfoUseDs(this.useDataSources)}),100)},this.displayDefaultClosestAnalysis=(e,t)=>{const s={dataSourceId:e[0].featureLayer.id,mainDataSourceId:e[0].featureLayer.id,rootDataSourceId:this.props.selectedDs};let i=[];i=Object.assign(i,this.useDataSources),i.push(s),this.useDataSources=i;const a={useDataSource:s,label:c(e[0].featureLayer.id).getLabel(),analysisInfo:M};this.setState({newAddedLayerAnalysis:t?[...this.state.newAddedLayerAnalysis,a]:[a],analysisIndex:this.state.newAddedLayerAnalysis.length,editCurrentLayer:{layerDsId:e[0].featureLayer.id,analysisType:e[0].analysisType}},(()=>{this.props.onAnalysisSettingsUpdated("layersInfo",this.state.newAddedLayerAnalysis)})),this.setState({showEditAnalysisPopper:!0})},this.closeEditAnalysisPopper=()=>{this.setSidePopperAnchor(this.state.analysisIndex),this.setState({showEditAnalysisPopper:!1,analysisIndex:null,editCurrentLayer:{layerDsId:"",analysisType:""}})},this.onEditButtonClick=(e,t,s,i)=>{this.setSidePopperAnchor(i),this.setState({showEditAnalysisPopper:e,analysisIndex:i,editCurrentLayer:{layerDsId:t,analysisType:s}})},this.setSidePopperAnchor=e=>{const t=this.analysisLayersPopperTrigger.current.getElementsByClassName("jimu-tree-item__body")[e];this.setState({popperFocusNode:t})},this.onDeleteButtonClick=(e,t,s,i)=>{this.setState({newAddedLayerAnalysis:e,analysisIndex:i},(()=>{this.props.onAnalysisSettingsUpdated("layersInfo",e),setTimeout((()=>{this.props.getAddedLayersInfoUseDs(this.useDataSources)}),100),-1===this.state.analysisIndex&&this.state.editCurrentLayer.layerDsId===t&&this.state.editCurrentLayer.analysisType===s&&this.closeEditAnalysisPopper()}))},this.updateLayersInfoSettings=(e,t,s,i)=>{this.setState({newAddedLayerAnalysis:e,analysisIndex:t,editCurrentLayer:{layerDsId:s,analysisType:i}},(()=>{this.props.onAnalysisSettingsUpdated("layersInfo",e)}))},this.onAnalysisInfoUpdate=(e,t,s,i)=>{this.setState({newAddedLayerAnalysis:e,analysisIndex:i,editCurrentLayer:{layerDsId:t,analysisType:s}},(()=>{this.props.onAnalysisSettingsUpdated("layersInfo",e);let t=[];e.forEach((e=>{t=Object.assign(t,this.useDataSources),t.push(e.useDataSource)})),this.useDataSources=t,setTimeout((()=>{this.props.getAddedLayersInfoUseDs(this.useDataSources)}),100)}))},this.props.activeDsLayersConfig&&(this.state={showLayersResultOption:null===(s=this.props.activeDsLayersConfig)||void 0===s?void 0:s.onlyShowLayersResult,showEditAnalysisPopper:!1,newAddedLayerAnalysis:(null===(l=null===(i=this.props.activeDsLayersConfig)||void 0===i?void 0:i.layersInfo)||void 0===l?void 0:l.length)>0?null===(r=this.props.activeDsLayersConfig)||void 0===r?void 0:r.layersInfo:[],displayFeatureCount:this.props.activeDsLayersConfig.displayFeatureCount,displayAnalysisIcon:this.props.activeDsLayersConfig.displayAnalysisIcon,layersAnalysisType:"",analysisIndex:null,editCurrentLayer:{layerDsId:"",analysisType:""},selectedLayerGeometryType:"",popperFocusNode:null}),this.useDataSources=this.props.useDataSourceConfig}render(){var s;return(0,e.jsx)("div",{css:l(this.props.theme),style:{height:"100%",width:"100%",marginTop:10}},(0,e.jsx)(t.SettingRow,{label:this.nls("configureLayerAnalysis")},(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("configureAnalysisTooltip"),title:this.nls("configureAnalysisTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 ml-2 d-inline"},(0,e.jsx)(I,null)))),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Button,{role:"button",className:"w-100 text-dark",type:"primary",onClick:this.onAddAnalysisClick.bind(this)},this.nls("addAnalysisLabel"))),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("layerAnalysisHint"),className:"font-italic w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("layerAnalysisHint")))),this.state.newAddedLayerAnalysis&&this.state.newAddedLayerAnalysis.length>0&&(0,e.jsx)("div",{ref:this.analysisLayersPopperTrigger,tabIndex:-1,className:"w-100 mb-3 mt-2"},(0,e.jsx)(J,{intl:this.props.intl,theme:this.props.theme,addedLayerAnalysis:this.state.newAddedLayerAnalysis,showEditAnalysisPopper:this.state.showEditAnalysisPopper,analysisIndex:this.state.analysisIndex,editCurrentLayer:this.state.editCurrentLayer,onEditAction:this.onEditButtonClick,onDeleteAction:this.onDeleteButtonClick.bind(this),onLayersInfoSettingsUpdated:this.updateLayersInfoSettings})),(0,e.jsx)(t.SettingRow,{label:this.nls("displayFeatureCountLabel")},(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("displayFeatureCountLabel"),title:this.nls("displayFeatureCountLabel"),checked:this.state.displayFeatureCount,onChange:this.displayFeatureCountStateChange})),(0,e.jsx)(t.SettingRow,{label:this.nls("displayAnalysisIconLabel")},(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("displayAnalysisIconLabel"),title:this.nls("displayAnalysisIconLabel"),checked:this.state.displayAnalysisIcon,onChange:this.displayAnalysisIconStateChange})),(0,e.jsx)(t.SettingRow,{className:"hiddenElements"},(0,e.jsx)(i.Label,{className:"w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("onlyShowResults"))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("onlyShowResults")+" "+this.nls("onlyShowResultsTooltip"),title:this.nls("onlyShowResultsTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"setting-text-level-2 mr-3 d-inline"},(0,e.jsx)(I,null))),(0,e.jsx)(i.Switch,{role:"switch","aria-label":this.nls("onlyShowResults"),title:this.nls("onlyShowResults"),checked:this.state.showLayersResultOption,onChange:this.onlyShowResultsOptionChange})),(0,e.jsx)(t.SidePopper,{isOpen:this.state.showEditAnalysisPopper&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.closeEditAnalysisPopper.bind(this),trigger:null===(s=this.analysisLayersPopperTrigger)||void 0===s?void 0:s.current,backToFocusNode:this.state.popperFocusNode},(0,e.jsx)("div",{className:"bg-light-300 border-color-gray-400",css:r(this.props.theme)},(0,e.jsx)(ne,{theme:this.props.theme,intl:this.props.intl,title:this.nls("editAnalysis"),ref:this.backRef,onBack:this.closeEditAnalysisPopper},(0,e.jsx)(ve,{widgetId:this.props.widgetId,intl:this.props.intl,theme:this.props.theme,activeDs:this.props.selectedDs,analysisIndex:this.state.analysisIndex,availableFeatureLayer:this.allDsLayers,editCurrentLayer:this.state.editCurrentLayer,analysisList:this.state.newAddedLayerAnalysis,selectedLayerGeometry:this.state.selectedLayerGeometryType,onAnalysisUpdate:this.onAnalysisInfoUpdate})))))}}var Ie=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function l(e){try{o(i.next(e))}catch(e){n(e)}}function r(e){try{o(i.throw(e))}catch(e){n(e)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(l,r)}o((i=i.apply(e,t||[])).next())}))};class Le extends s.BaseWidgetSetting{constructor(t){super(t),this.mvManager=a.MapViewManager.getInstance(),this._mapLoadedTimer=null,this.analysisSettingPopperTrigger=e.React.createRef(),this.nls=e=>{var t;const s=Object.assign({},n);return(null===(t=this.props.intl)||void 0===t?void 0:t.formatMessage)?this.props.intl.formatMessage({id:e,defaultMessage:s[e]}):s[e]},this.componentDidMount=()=>{var t,s;let i;if(this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0){const a=null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0];(null===(s=(0,e.getAppStore)().getState().appStateInBuilder.appConfig.widgets)||void 0===s?void 0:s[a])?(i=!1,this.checkLayersAvailability(this.props.useMapWidgetIds)):(this.resetAnalysisLayersConfig(),i=!0)}else i=!0;this.updateConfigForMapWidget(i),setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["generalSettings","noResultsFoundText"],this.props.config.generalSettings.noResultsFoundText?this.props.config.generalSettings.noResultsFoundText:this.nls("noDataMessageDefaultText"))})}),50),setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["generalSettings","highlightColor"],this.props.config.generalSettings.highlightColor?this.props.config.generalSettings.highlightColor:this.props.theme2.colors.palette.primary[700])})}),50)},this.onMapWidgetSelected=t=>{let s;this.resetAnalysisLayersConfig(),setTimeout((()=>{this.props.onSettingChange({id:this.props.id,useMapWidgetIds:t})}),100),t.length>0?(s=!1,this.checkLayersAvailability(t)):(s=!0,setTimeout((()=>{this.props.onSettingChange({id:this.props.id,useDataSources:(0,e.Immutable)([])})}),100)),this.updateConfigForMapWidget(s)},this.resetAnalysisLayersConfig=()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("configInfo",{})})},this.updateConfigForMapWidget=e=>{setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("useMapWidget",!e)})}),50),this.setState({mapWidgetExists:!e,isNoMapSelected:e})},this.setDefaultConfigForDataSource=t=>{if(!this.props.config.configInfo.hasOwnProperty(t)){const s=k;s.searchSettings.headingLabel=this.nls("locationLabel"),this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",t],s)});let i=[];i=Object.assign(i,this.props.useDataSources),setTimeout((()=>{this.props.onSettingChange({id:this.props.id,useDataSources:(0,e.Immutable)(i)})}),100)}},this.waitForChildDataSourcesReady=t=>Ie(this,void 0,void 0,(function*(){yield null==t?void 0:t.whenAllJimuLayerViewLoaded();const s=e.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.dataSourceId);return(null==s?void 0:s.isDataSourceSet)&&!s.areChildDataSourcesCreated()?s.childDataSourcesReady().then((()=>s)).catch((e=>s)):Promise.resolve(s)})),this.checkLayersAvailability=t=>Ie(this,void 0,void 0,(function*(){const s=this.mvManager.getJimuMapViewGroup(t);if(null==s?void 0:s.jimuMapViews){this._mapLoadedTimer&&clearTimeout(this._mapLoadedTimer);const i=[];for(const n in s.jimuMapViews)if(s.jimuMapViews[n].dataSourceId)if(s.jimuMapViews[n].status===e.JimuMapViewStatus.Loaded){const e=[],t=s.jimuMapViews[n].dataSourceId;this.setDefaultConfigForDataSource(t);const l=a.MapViewManager.getInstance().getJimuMapViewById(s.jimuMapViews[n].id);yield this.waitForChildDataSourcesReady(l).finally((()=>Ie(this,void 0,void 0,(function*(){yield S(s.jimuMapViews[n].id).then((t=>{this.setState({isLayerAvailable:!0,jimuMapViewId:s.jimuMapViews[n].id}),(s.jimuMapViews[n].isActive||void 0===s.jimuMapViews[n].isActive)&&this.setState({activeDataSource:t.length>0?s.jimuMapViews[n].dataSourceId:""}),t.forEach((t=>{e.push({layerDsId:t.id})})),this.canAddDataSource(s.jimuMapViews[n].dataSourceId,i)&&i.push({label:this.getDataSourceLabel(s.jimuMapViews[n].dataSourceId),value:s.jimuMapViews[n].dataSourceId,isValid:t.length>0,availableLayers:e})}))}))))}else this._mapLoadedTimer=setTimeout((()=>{this.checkLayersAvailability(t)}),50);else this.setState({isLayerAvailable:!1});this.setState({dataSources:i},(()=>{this.updateConfigAsPerNewWebMap()}))}else this._mapLoadedTimer=setTimeout((()=>{this.checkLayersAvailability(t)}),50)})),this.canAddDataSource=(e,t)=>{let s=!0;return t.some((t=>{t.value===e&&(s=!1)})),s},this.getDataSourceLabel=e=>e?c(e).getLabel()||e:"",this.updateConfigAsPerNewWebMap=()=>Ie(this,void 0,void 0,(function*(){var t;let s=[];if((null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t.length)>0){const t=this.mvManager.getJimuMapViewGroup(this.props.useMapWidgetIds[0]),i=this.props.config.configInfo.asMutable({deep:!0});if(null==t?void 0:t.jimuMapViews){for(const e in t.jimuMapViews)t.jimuMapViews[e].dataSourceId?s.push(t.jimuMapViews[e].dataSourceId):s=[];for(const e in i)s.includes(e)||delete i[e];for(const s in t.jimuMapViews){const a=t.jimuMapViews[s].dataSourceId;i[a]&&t.jimuMapViews[s].status===e.JimuMapViewStatus.Loaded&&(yield S(t.jimuMapViews[s].id).then((e=>{var t,s;const n=[];e.forEach((e=>{n.push(e.id)})),null===(s=null===(t=this.props.config.configInfo[a].analysisSettings)||void 0===t?void 0:t.layersInfo)||void 0===s||s.forEach((e=>{if(!n.includes(e.useDataSource.dataSourceId)){const t=i[a].analysisSettings.layersInfo,s=t.findIndex((t=>t.useDataSource.dataSourceId===e.useDataSource.dataSourceId));s>-1&&t.splice(s,1)}}))})))}setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("configInfo",(0,e.Immutable)(i))})}),100),setTimeout((()=>{this.saveUseDataSourcesProps(this.props.useDataSources)}),200)}}})),this.showDsPanel=(e,t)=>{this.setSidePopperAnchor(t),t===this.index?(this.setState({showDataItemPanel:!this.state.showDataItemPanel,showWarningMessage:!e.isValid}),this.maintainStatesOnDsClick(e)):(this.setState({showDataItemPanel:!0,showWarningMessage:!e.isValid}),this.maintainStatesOnDsClick(e),this.index=t),this.setDefaultConfigForDataSource(e.value)},this.maintainStatesOnDsClick=e=>{this.setState({dataSourceName:e.label,activeDataSource:e.value,isSearchSettingsOpen:!1,isAnalysisSettingsOpen:!1},(()=>{this.setState({isSearchSettingsOpen:!0,isAnalysisSettingsOpen:!0})}))},this.setSidePopperAnchor=e=>{const t=this.analysisSettingPopperTrigger.current.getElementsByClassName("jimu-tree-item__body")[e];this.setState({popperFocusNode:t})},this.createDsElement=(t,s)=>(0,e.jsx)("div",{key:s,className:"data-item align-items-center"},(0,e.jsx)("div",{className:"data-item-name w-100",title:t.label},t.label),!t.isValid&&(0,e.jsx)("div",{style:{paddingLeft:5,paddingRight:5}},(0,e.jsx)(_,{size:"m",color:"#ff0000"}))),this.onCloseDataItemPanel=()=>{this.setState({showDataItemPanel:!1}),this.index=0},this.onToggleGeneralSettings=()=>{this.setState({isGeneralSettingsOpen:!this.state.isGeneralSettingsOpen})},this.onToggleSearchSettings=()=>{this.setState({isSearchSettingsOpen:!this.state.isSearchSettingsOpen})},this.onToggleAnalysisSettings=()=>{this.setState({isAnalysisSettingsOpen:!this.state.isAnalysisSettingsOpen})},this.updateGeneralSettings=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["generalSettings",e],t)})},this.updateSearchSettings=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",this.state.activeDataSource,"searchSettings",e],t)})},this.updateAnalysisSettings=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.setIn(["configInfo",this.state.activeDataSource,"analysisSettings",e],t)})},this.saveUseDataSourcesProps=e=>{const t=[];let s=[];const i=(null==e?void 0:e.length)>0?null==e?void 0:e.filter(((t,s)=>e.findIndex((e=>e.dataSourceId===t.dataSourceId))===s)):[];i.length>0&&i.forEach(((e,s)=>{if(this.props.config.configInfo.hasOwnProperty(e.rootDataSourceId)){const s=this.props.config.configInfo[e.rootDataSourceId].analysisSettings.layersInfo;s.length>0&&s.forEach((s=>{s.useDataSource.dataSourceId===e.dataSourceId&&(t.length>0?null==t||t.forEach((s=>{s.dataSourceId!==e.dataSourceId&&t.push(e)})):t.push(e))}))}})),s=t.length>0?null==t?void 0:t.filter(((e,s)=>t.findIndex((t=>t.dataSourceId===e.dataSourceId))===s)):[],setTimeout((()=>{this.props.onSettingChange({id:this.props.id,useDataSources:s})}),100)},this.index=0,this.state={dataSources:[],showDataItemPanel:!1,dataSourceName:"",isNoMapSelected:!0,mapWidgetExists:!0,isAnalysisSettingsOpen:!1,isGeneralSettingsOpen:!0,isSearchSettingsOpen:!0,isOutputSettingsOpen:!0,isLayerAvailable:!1,activeDataSource:null,popperFocusNode:null,showWarningMessage:!1,jimuMapViewId:""}}render(){var s,a,n,l,r,o;return(0,e.jsx)("div",{css:(o=this.props.theme,e.css`
    .widget-setting-near-me {
      height: 100%;

      .map-selector-section .component-map-selector .form-control {
        width: 100%;
      }

      .nearme-analysis-tooltip {
        margin-bottom: 0rem!important;
        width: 177px;
      }

      .placeholder-container {
        height: calc(100% - 180px);

        .placeholder {
          flex-direction: column;

          .icon {
            color: var(--dark-200);
          }

          .hint {
            font-size: ${e.polished.rem(14)};
            font-weight: 500;
            color: var(--dark-500);
            max-width: ${e.polished.rem(160)};
          }
        }
      }

      .color-label {
        color: ${o.colors.palette.dark[400]};
      }

      .jimu-tree {
        width: 100%;
      }

      .data-item {
        display: flex;
        flex: 1;
        padding: 0.5rem 0.6rem;
        line-height: 23px;
        cursor: pointer;

        .data-item-name {
          word-break: break-word;
        }
      }
    }
  `),className:"h-100"},(0,e.jsx)("div",{className:"widget-setting-near-me"},(0,e.jsx)(t.SettingSection,{className:(0,e.classNames)("map-selector-section",{"border-0":this.state.isNoMapSelected})},(0,e.jsx)(t.SettingRow,null,(0,e.jsx)("div",{className:"text-truncate setting-text-level-0",title:this.nls("selectMapWidgetLabel")},this.nls("selectMapWidgetLabel"))),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(t.MapWidgetSelector,{onSelect:this.onMapWidgetSelected.bind(this),useMapWidgetIds:this.props.useMapWidgetIds})),this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0&&this.state.mapWidgetExists&&!this.state.isLayerAvailable&&(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Alert,{tabIndex:0,onClose:function(){},open:!this.state.isLayerAvailable,text:this.nls("warningMsgIfNoLayersOnMap"),type:"warning"}))),this.state.isNoMapSelected&&(0,e.jsx)("div",{className:"d-flex placeholder-container justify-content-center align-items-center"},(0,e.jsx)("div",{className:"d-flex text-center placeholder justify-content-center align-items-center "},(0,e.jsx)(p,{size:48,className:"d-flex icon mb-2"}),(0,e.jsx)("p",{className:"hint"},this.nls("selectMapHint")))),this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0&&this.state.mapWidgetExists&&this.state.isLayerAvailable&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingSection,null,(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("dataConfigLabel"),title:this.nls("dataConfigLabel"),className:"w-100 d-flex",style:{maxWidth:"88%"}},(0,e.jsx)("div",{className:"text-truncate flex-grow-1 color-label setting-text-level-0"},this.nls("dataConfigLabel"))),(0,e.jsx)(i.Tooltip,{role:"tooltip",tabIndex:0,"aria-label":this.nls("dataConfigTooltip"),title:this.nls("dataConfigTooltip"),showArrow:!0,placement:"top"},(0,e.jsx)("div",{className:"ml-2 d-inline"},(0,e.jsx)(I,null)))),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Label,{tabIndex:0,"aria-label":this.nls("mapSettingsHintMsg"),className:"font-italic w-100 d-flex"},(0,e.jsx)("div",{className:"flex-grow-1 text-break setting-text-level-3"},this.nls("mapSettingsHintMsg")))),(0,e.jsx)(t.SettingRow,null,(0,e.jsx)("div",{ref:this.analysisSettingPopperTrigger,className:"w-100"},(0,e.jsx)(H.List,{itemsJson:Array.from(this.state.dataSources).map(((e,t)=>({itemStateDetailContent:e,itemStateChecked:this.state.showDataItemPanel&&this.index===t,itemKey:`${t}`}))),dndEnabled:!1,onClickItemBody:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];this.showDsPanel(i.itemStateDetailContent,a.indexOf(i))},overrideItemBlockInfo:()=>({name:H.TreeItemActionType.RenderOverrideItem,children:[{name:H.TreeItemActionType.RenderOverrideItemBody,children:[{name:H.TreeItemActionType.RenderOverrideItemMainLine}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,i=s[0],a=s[1];return this.createDsElement(i.itemStateDetailContent,a.indexOf(i))}})))),(0,e.jsx)(t.SettingSection,null,(0,e.jsx)(i.CollapsablePanel,{label:this.nls("generalSettingsLabel"),"aria-label":this.nls("generalSettingsLabel"),isOpen:this.state.isGeneralSettingsOpen,onRequestOpen:()=>{this.onToggleGeneralSettings()},onRequestClose:()=>{this.onToggleGeneralSettings()}},(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(A,{intl:this.props.intl,theme:this.props.theme2,config:this.props.config.generalSettings,onGeneralSettingsUpdated:this.updateGeneralSettings}))))),this.props.useMapWidgetIds&&this.props.useMapWidgetIds.length>0&&this.state.mapWidgetExists&&this.state.isLayerAvailable&&(0,e.jsx)(t.SidePopper,{css:(this.props.theme,e.css`
  .collapsibleLabel {
    margin-bottom: 0rem!important;
  }

  .warningMsg {
    padding: 0.25rem!important;
    margin-top: 20px;
    margin-left: 10px;
  }
`),isOpen:this.state.showDataItemPanel&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",trigger:null===(s=this.analysisSettingPopperTrigger)||void 0===s?void 0:s.current,toggle:this.onCloseDataItemPanel.bind(this),backToFocusNode:this.state.popperFocusNode,title:this.state.dataSourceName},this.state.showWarningMessage&&(0,e.jsx)(t.SettingRow,null,(0,e.jsx)(i.Alert,{tabIndex:0,className:"warningMsg",onClose:function(){},open:this.state.showWarningMessage,text:this.nls("warningMsgIfNoLayersOnMap"),type:"warning"})),!this.state.showWarningMessage&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(t.SettingSection,null,(0,e.jsx)(i.CollapsablePanel,{label:this.nls("searchSettingsLabel"),"aria-label":this.nls("searchSettingsLabel"),isOpen:this.state.isSearchSettingsOpen,onRequestOpen:()=>{this.onToggleSearchSettings()},onRequestClose:()=>{this.onToggleSearchSettings()}},(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(G,{intl:this.props.intl,theme:this.props.theme2,config:null===(n=null===(a=this.props.config.configInfo)||void 0===a?void 0:a[this.state.activeDataSource])||void 0===n?void 0:n.searchSettings,onSearchSettingsUpdated:this.updateSearchSettings})))),(0,e.jsx)(t.SettingSection,null,(0,e.jsx)(i.CollapsablePanel,{label:this.nls("analysisSettingsLabel"),"aria-label":this.nls("analysisSettingsLabel"),isOpen:this.state.isAnalysisSettingsOpen,onRequestOpen:()=>{this.onToggleAnalysisSettings()},onRequestClose:()=>{this.onToggleAnalysisSettings()}},(0,e.jsx)(t.SettingRow,{flow:"wrap"},(0,e.jsx)(Ce,{widgetId:this.props.id,intl:this.props.intl,theme:this.props.theme,selectedDs:this.state.activeDataSource,activeDsLayersConfig:null===(r=null===(l=this.props.config.configInfo)||void 0===l?void 0:l[this.state.activeDataSource])||void 0===r?void 0:r.analysisSettings,allFeatureLayers:this.state.dataSources,useDataSourceConfig:this.props.useDataSources,onAnalysisSettingsUpdated:this.updateAnalysisSettings,getAddedLayersInfoUseDs:this.saveUseDataSourcesProps}))))))))}}function we(e){m.p=e}})(),y})())}}}));